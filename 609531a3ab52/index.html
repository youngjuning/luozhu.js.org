<!DOCTYPE html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>掘金一下 | 从零开发一款基于 webview 的 vscode 扩展 | 洛竹的博客</title><meta name=author content=洛竹><meta name=copyright content=洛竹><meta name=format-detection content="telephone=no"><meta name=theme-color content=ffffff><meta name=description content="在团队降本提效的基建中，洛竹开发了一款 vscode 插件，第一版我使用的是 vscode 内置 UI，虽说也能用，但是用户体验欠佳。由于 vscode 内置 UI 不够灵活，一番调研后我决定使用 webview 重构。"><meta property=og:type content=article><meta property=og:title content="掘金一下 | 从零开发一款基于 webview 的 vscode 扩展"><meta property=og:url content=https://youngjuning.js.org/609531a3ab52/ ><meta property=og:site_name content=洛竹的博客><meta property=og:description content="在团队降本提效的基建中，洛竹开发了一款 vscode 插件，第一版我使用的是 vscode 内置 UI，虽说也能用，但是用户体验欠佳。由于 vscode 内置 UI 不够灵活，一番调研后我决定使用 webview 重构。"><meta property=og:locale content=zh_CN><meta property=og:image content=https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f53c4850008a49a5baa25a0e5f1b626b~tplv-k3u1fbpfcp-zoom-crop-mark:3024:3024:3024:1702.awebp><meta property=article:published_time content=2023-02-28T16:55:47.000Z><meta property=article:modified_time content=2023-05-04T04:25:50.733Z><meta property=article:author content=洛竹><meta property=article:tag content=掘金><meta property=article:tag content="VS Code"><meta property=article:tag content=Webview><meta property=article:tag content=扩展><meta name=twitter:card content=summary><meta name=twitter:image content=https://pbs.twimg.com/profile_images/1628559000953565186/HVtTFoKv_x96.jpg><meta name=twitter:creator content=@luozhu2021><meta name=twitter:site content=https://twitter.com/luozhu2021><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1680450378978.png><link rel=canonical href=https://youngjuning.js.org/609531a3ab52/ ><link rel=preconnect href=//cdn.jsdelivr.net><link rel=preconnect href=//www.google-analytics.com crossorigin=""><link rel=preconnect href=//busuanzi.ibruce.info><meta name=google-site-verification content=ohZ0A8YKJu755suq7WOIJkLGDfj3BGU4isb8RKI5Cj8><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css media=print onload='this.media="all"'><script async=async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-7962287588031867",enable_page_level_ads:"true"})</script><script async=async src="https://www.googletagmanager.com/gtag/js?id=G-M7KEMBRVPJ"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-M7KEMBRVPJ")</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"It has been",messageNext:"days since the last update, the content of the article may be outdated."},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:100,languages:{author:"作者: 洛竹",link:"链接: ",source:"来源: 洛竹的博客",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#59C173",bgDark:"#1f1f1f",position:"bottom-left"},source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!0,islazyload:!0,isAnchor:!0,percent:{toc:!0,rightside:!0}}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"掘金一下 | 从零开发一款基于 webview 的 vscode 扩展",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-05-04 12:25:50"}</script><noscript><style type=text/css>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel=stylesheet href=/css/footer.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css media=defer onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css media=defer onload='this.media="all"'><script src=https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js></script><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title=洛竹的博客 type=application/atom+xml><link rel=alternate href=/rss2.xml title=洛竹的博客 type=application/rss+xml></head><body><div id=web_bg></div><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1680450378978.png onerror='onerror=null,src="/img/friend_404.gif"' alt=avatar></div><div class="sidebar-site-data site-data is-center"><a href=/archives/ ><div class=headline>文章</div><div class=length-num>142</div></a><a href=/tags/ ><div class=headline>标签</div><div class=length-num>480</div></a><a href=/categories/ ><div class=headline>分类</div><div class=length-num>50</div></a></div><hr><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/react-interview/ ><i class="fa-fw fab fa-react"></i><span> React 面试题</span></a></li><li><a class="site-page child" href=/categories/Golang/Go-%E8%AF%AD%E8%A8%80%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/ ><i class="fa-fw fas fa-book"></i><span> Go 语言系列教程</span></a></li></ul></div><div class=menus_item><a class=site-page href=/stack/ ><i class="fa-fw fas fa-location-arrow"></i><span> 导航</span></a></div><div class=menus_item><a class=site-page href=/album/ ><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class=menus_item><a class=site-page href=/timeline/ ><i class="fa-fw fas fa-stream"></i><span> 时间轴</span></a></div><div class=menus_item><a class=site-page href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></div><div class=menus_item><a class=site-page target=_blank rel="noopener external nofollow noreferrer" href=https://travellings.vercel.app/ ><i class="fa-fw fas fa-paper-plane"></i><span> 开往宇宙</span></a></div><div class=menus_item><a class=site-page href=/friends/ ><i class="fa-fw fas fa-link"></i><span> 友人</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/english-slang/ ><i class="fa-fw fas fa-book-reader"></i><span> 生词本</span></a></li><li><a class="site-page child" href=/projects/ ><i class="fa-fw fab fa-github"></i><span> 项目</span></a></li><li><a class="site-page child" href=/movies/ ><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href=/books/ ><i class="fa-fw fas fa-book"></i><span> 阅读</span></a></li><li><a class="site-page child" href=/bangumi/ ><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></li></ul></div></div></div></div><div class=post id=body-wrap><header class=post-bg id=page-header style=background-image:url(https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f53c4850008a49a5baa25a0e5f1b626b~tplv-k3u1fbpfcp-zoom-crop-mark:3024:3024:3024:1702.awebp)><nav id=nav><span id=blog-info><a href=/ title=洛竹的博客><img class=site-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1680450378978.png><span class=site-name>洛竹的博客</span></a></span><div id=menus><div id=search-button><a class="site-page social-icon search" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fa-fw fas fa-lines-leaning"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/react-interview/ ><i class="fa-fw fab fa-react"></i><span> React 面试题</span></a></li><li><a class="site-page child" href=/categories/Golang/Go-%E8%AF%AD%E8%A8%80%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/ ><i class="fa-fw fas fa-book"></i><span> Go 语言系列教程</span></a></li></ul></div><div class=menus_item><a class=site-page href=/stack/ ><i class="fa-fw fas fa-location-arrow"></i><span> 导航</span></a></div><div class=menus_item><a class=site-page href=/album/ ><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class=menus_item><a class=site-page href=/timeline/ ><i class="fa-fw fas fa-stream"></i><span> 时间轴</span></a></div><div class=menus_item><a class=site-page href=/random/ ><i class="fa-fw fas fa-random"></i><span> 随便逛逛</span></a></div><div class=menus_item><a class=site-page target=_blank rel="noopener external nofollow noreferrer" href=https://travellings.vercel.app/ ><i class="fa-fw fas fa-paper-plane"></i><span> 开往宇宙</span></a></div><div class=menus_item><a class=site-page href=/friends/ ><i class="fa-fw fas fa-link"></i><span> 友人</span></a></div><div class=menus_item><a class="site-page group" href=javascript:void(0); rel="external nofollow noreferrer"><i class="fa-fw fas fa-heart"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class=menus_item_child><li><a class="site-page child" href=/about/ ><i class="fa-fw fas fa-spa"></i><span> 关于</span></a></li><li><a class="site-page child" href=/english-slang/ ><i class="fa-fw fas fa-book-reader"></i><span> 生词本</span></a></li><li><a class="site-page child" href=/projects/ ><i class="fa-fw fab fa-github"></i><span> 项目</span></a></li><li><a class="site-page child" href=/movies/ ><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href=/books/ ><i class="fa-fw fas fa-book"></i><span> 阅读</span></a></li><li><a class="site-page child" href=/bangumi/ ><i class="fa-fw fas fa-tv"></i><span> 追番</span></a></li></ul></div></div><div id=toggle-menu><a class=site-page href=javascript:void(0); rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id=post-info><h1 class=post-title>掘金一下 | 从零开发一款基于 webview 的 vscode 扩展<a class=post-edit-link href=https://github.com/youngjuning/youngjuning.github.io/edit/main/source/_posts/掘金一下-从零开发一款基于-webview-的-vscode-扩展.md rel="external nofollow noreferrer" title=编辑 target=_blank><i class="fas fa-pencil-alt"></i></a></h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class=post-meta-label>发表于</span><time datetime=2023-02-28T16:55:47.000Z title="发表于 2023-03-01 00:55:47">2023-03-01</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E5%89%8D%E7%AB%AF/ >前端</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/%E5%89%8D%E7%AB%AF/VS-Code/ >VS Code</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>字数总计:</span><span class=word-count>9.8k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>阅读时长:</span><span>39分钟</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title="掘金一下 | 从零开发一款基于 webview 的 vscode 扩展"><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>阅读量:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class=post-content id=article-container><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-7962287588031867 data-ad-slot=2542544532></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></p><blockquote><p>⚠️本文为掘金社区首发签约文章，未获授权禁止转载</p><p>温馨提示：结合本文配套<a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning/juejin-me>源码</a>阅读体验更佳！</p></blockquote><h2 id=前言><a href=#前言 class=headerlink title=前言></a>前言</h2><p>在团队降本提效的基建中，洛竹开发了一款 vscode 插件，第一版我使用的是 vscode 内置 UI，虽说也能用，但是用户体验欠佳。由于 vscode 内置 UI 不够灵活，一番调研后我决定使用 webview 重构。</p><p>开发过 vscode 插件的同学可能对插件开发知识点多、文档阅读困难、参考资料少有所体会。基于 webview 开发插件更是如此，寻遍网络，虽然有优秀的项目，但却没有完整且优秀的教程。为了修炼 vscode 开发灵力，不妨和洛竹一起挑战从零到一开发一款基于 webview 的 vscode 插件。</p><h2 id=Hello-vscode><a href=#Hello-vscode class=headerlink title="Hello vscode"></a>Hello vscode</h2><p>英雄多起于市井，高楼皆起于平地。再伟大的软件也都是从 Hello World 开始的，本章尽量用最简洁的语言描述一个 vscode 插件 Hello World 的诞生。</p><h3 id=初始化项目><a href=#初始化项目 class=headerlink title=初始化项目></a>初始化项目</h3><p>安装 <a target=_blank rel="noopener external nofollow noreferrer" href=http://yeoman.io/ >Yeoman</a> 和 <a target=_blank rel="noopener external nofollow noreferrer" href=https://www.npmjs.com/package/generator-code>VS Code Extension Generator</a>：</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>$ npm install -g yo generator-code</span><br></pre></td></tr></table></figure><p>这个脚手架会生成一个可以立马开发的项目。运行生成器，然后填好下列字段：</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre></td><td class=code><pre><span class=line>$ yo code</span><br><span class=line><span class=comment>#     _-----_     ╭──────────────────────────╮</span></span><br><span class=line><span class=comment>#    |       |    │   Welcome to the Visual  │</span></span><br><span class=line><span class=comment>#    |--(o)--|    │   Studio Code Extension  │</span></span><br><span class=line><span class=comment>#   `---------´   │        generator!        │</span></span><br><span class=line><span class=comment>#    ( _´U`_ )    ╰──────────────────────────╯</span></span><br><span class=line><span class=comment>#    /___A___\   /</span></span><br><span class=line><span class=comment>#     |  ~  |</span></span><br><span class=line><span class=comment>#   __&#x27;.___.&#x27;__</span></span><br><span class=line><span class=comment># ´   `  |° ´ Y `</span></span><br><span class=line></span><br><span class=line><span class=comment># ? What type of extension do you want to create? New Extension (TypeScript)</span></span><br><span class=line><span class=comment># ? What&#x27;s the name of your extension? Juejin Posts</span></span><br><span class=line><span class=comment># ? What&#x27;s the identifier of your extension? juejin-posts</span></span><br><span class=line><span class=comment># ? What&#x27;s the description of your extension? 掘金文章管理</span></span><br><span class=line><span class=comment># ? Initialize a git repository? Yes</span></span><br><span class=line><span class=comment># ? Bundle the source code with webpack? No</span></span><br><span class=line><span class=comment># ? Which package manager to use? yarn</span></span><br><span class=line></span><br><span class=line>$ code ./juejin-posts</span><br></pre></td></tr></table></figure><blockquote><p>提交记录：<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/IaJdlW>hello world</a></p></blockquote><h3 id=代码规范><a href=#代码规范 class=headerlink title=代码规范></a>代码规范</h3><p>默认的脚手架生成的也有 ESLint 配置，但是 Editor、Prettier 的配置都没有，并且 ESLint 配置也不符合我的习惯。洛竹关于前端工程化的包都在 <a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning/luozhu>youngjuning/luozhu</a>， ESlint 配置的包是 <code>@luozhu/eslint-config-*</code>。由于我们开发插件使用的是 Typescript，所以我们选择 <code>@luozhu/eslint-config-typescript</code>。</p><p><strong>安装依赖：</strong></p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>$ yarn add @luozhu/eslint-config-typescript @luozhu/prettier-config prettier -D</span><br></pre></td></tr></table></figure><p><strong>具体配置：</strong></p><p>配置涉及文件较多，请参考 <a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning/luozhu#coding-style>coding-style</a>，不关心的同学也可以直接略过。</p><p><strong>提交检测：</strong></p><p>安装依赖：</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>$ yarn add lint-staged yorkie -D</span><br></pre></td></tr></table></figure><p>修改配置：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// package.json</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;gitHooks&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;pre-commit&quot;</span><span class=punctuation>:</span> <span class=string>&quot;lint-staged&quot;</span></span><br><span class=line>  <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;lint-staged&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;**/*.&#123;js,jsx,ts,tsx&#125;&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;eslint --fix&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;**/*.&#123;md,json&#125;&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;prettier --write&quot;</span><span class=punctuation>]</span></span><br><span class=line>  <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p><strong>eslint —fix：</strong></p><p>修改完配置之后需要执行 fix 对所有文件格式化一次。</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>$ yarn lint --fix</span><br></pre></td></tr></table></figure><blockquote><p>提交记录：<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/xzFAVE>chore: code style config</a></p></blockquote><h3 id=约定式提交><a href=#约定式提交 class=headerlink title=约定式提交></a>约定式提交</h3><p>约定式提交我使用的是渐进式脚手架 <code>@luozhu/create-commitlint</code>，在项目中执行 <code>npx @luozhu/create-commitlint</code> 即可使项目符合规范化提交的配置。对规范化提交不了解的同学，强烈建议读一下 <a target=_blank rel="noopener external nofollow noreferrer" href=https://juejin.cn/post/6877462747631026190/ >一文搞定 Conventional Commits </a>。</p><blockquote><p>提交记录：<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/Ld142y>chore: npx @luozhu/create-commitlint</a></p></blockquote><h3 id=调试><a href=#调试 class=headerlink title=调试></a>调试</h3><p>按下 <code>F5</code> 开启调试会出现[扩展开发宿主]窗口，然后按 <code>Command+Shift+P</code> 组件键输入 <code>Hello World</code> 命令。如下图所示 vscode 弹出了 <code>Hello World from Juejin Posts!</code> 的提示。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc26d7d429f84564b88b55e9df60fcd7~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>同时我们的开发窗口中，会出现一个 watch 任务的终端：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75a15d0bd2cc4096af1a3f76173cbbe1~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>开发窗口的调试控制台会输出插件运行日志（忽略红色的警告）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c31068ea0bca4d4793e35bdb16d70c0a~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>调试执行的任务是在 <code>.vscode/tasks.json</code> 中配置的：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// See https://go.microsoft.com/fwlink/?LinkId=733558</span></span><br><span class=line><span class=comment>// for the documentation about the tasks.json format</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>	<span class=attr>&quot;version&quot;</span><span class=punctuation>:</span> <span class=string>&quot;2.0.0&quot;</span><span class=punctuation>,</span> <span class=comment>// 配置的版本号。</span></span><br><span class=line>	<span class=attr>&quot;tasks&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span> <span class=comment>// 任务配置。通常是外部任务运行程序中已定义任务的扩充。</span></span><br><span class=line>		<span class=punctuation>&#123;</span></span><br><span class=line>			<span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;npm&quot;</span><span class=punctuation>,</span> <span class=comment>// 要自定义的任务类型。</span></span><br><span class=line>			<span class=attr>&quot;script&quot;</span><span class=punctuation>:</span> <span class=string>&quot;watch&quot;</span><span class=punctuation>,</span> <span class=comment>// 要自定义的 npm 脚本。</span></span><br><span class=line>			<span class=attr>&quot;problemMatcher&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$tsc-watch&quot;</span><span class=punctuation>,</span> <span class=comment>// 要使用的问题匹配程序。可以是一个字符串或一个问题匹配程序定义，也可以是一个字符串数组和多个问题匹配程序。</span></span><br><span class=line>			<span class=attr>&quot;isBackground&quot;</span><span class=punctuation>:</span> <span class=literal><span class=keyword>true</span></span><span class=punctuation>,</span> <span class=comment>// 执行的任务是否保持活动状态并在后台运行。</span></span><br><span class=line>			<span class=attr>&quot;presentation&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span> <span class=comment>// 配置用于显示任务输出并读取其输入的面板。</span></span><br><span class=line>				<span class=attr>&quot;reveal&quot;</span><span class=punctuation>:</span> <span class=string>&quot;never&quot;</span> <span class=comment>// 控制运行任务的终端是否显示。可按选项 &quot;revealProblems&quot; 进行替代。默认设置为“始终”。</span></span><br><span class=line>			<span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>			<span class=attr>&quot;group&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span> <span class=comment>// 定义此任务属于的执行组。它支持 &quot;build&quot; 以将其添加到生成组，也支持 &quot;test&quot; 以将其添加到测试组。</span></span><br><span class=line>				<span class=attr>&quot;kind&quot;</span><span class=punctuation>:</span> <span class=string>&quot;build&quot;</span><span class=punctuation>,</span> <span class=comment>// 任务的执行组。</span></span><br><span class=line>				<span class=attr>&quot;isDefault&quot;</span><span class=punctuation>:</span> <span class=literal><span class=keyword>true</span></span> <span class=comment>// 定义此任务是否为组中的默认任务。</span></span><br><span class=line>			<span class=punctuation>&#125;</span></span><br><span class=line>		<span class=punctuation>&#125;</span></span><br><span class=line>	<span class=punctuation>]</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h2 id=打包><a href=#打包 class=headerlink title=打包></a>打包</h2><p>我们的插件开发完成前，想要分享给小伙伴体验可以吗？答案是肯定的，vscode 为我们提供了 <a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/microsoft/vscode-vsce>vsce</a> 实现这个需求，我们将 vsce 模块安装到全局，然后使用 <code>vsce package</code> 命令尝试打包：</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>$ vsce package</span><br><span class=line> ERROR  Missing publisher name. Learn more: https://code.visualstudio.com/api/working-with-extensions/publishing-extension<span class=comment>#publishing-extensions</span></span><br></pre></td></tr></table></figure><p>啊，咋还报错了？<code>publisher</code> 是啥？？一脸懵逼。不慌，按<a target=_blank rel="noopener external nofollow noreferrer" href=https://code.visualstudio.com/api/working-with-extensions/publishing-extension#create-a-publisher>链接</a> 我知道了 publisher 是一个可以将扩展发布到Visual Studio Code Marketplace 的身份。每个扩展都需要在其 <code>package.json</code> 文件中包含一个发布者名称。如果注册发布者我们后面详说，这里我们把 <code>publisher</code> 设置为 <code>luozhu</code>。</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>$ vsce package</span><br><span class=line> INFO  Detected presence of yarn.lock. Using <span class=string>&#x27;yarn&#x27;</span> instead of <span class=string>&#x27;npm&#x27;</span> (to override this pass <span class=string>&#x27;--no-yarn&#x27;</span> on the <span class=built_in>command</span> line).</span><br><span class=line> ERROR  Make sure to edit the README.md file before you package or publish your extension.</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf561381232b4690a5d7cd0378c267d7~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>额，裂开，这咋还报错，假装淡定，读一下提示原来是要我们编辑一下 README.md，没错，vscode 模板里有初始的 README，我们需要编辑一下才可以打包。修改后再次尝试 <code>vsce package</code>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/acfe2e957c9545578c7b6990371a3f0b~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>终于，打包成功！为了追求完美，最后我们再来做一些优化工作：</p><ol><li>执行 <code>vsce package</code> 的时候加上 <code>--no-yarn</code></li><li>在 <em>package.json</em> 中加上 <code>repository</code> 字段即可看不到任何警告。</li><li>为了便捷，我们将 vsce 安装到项目中，然后把 <code>vsce package --no-yarn</code> 添加到 npm scripts 中。</li><li><em>package.json</em> 加上 <code>license</code> 字段。</li></ol><p>然后再次尝试 <code>yarn package</code> 就完美了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a9a251834b945c8a882039020f56e4f~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><blockquote><p>提示：vsce package 会先执行 <code>vscode:prepublish</code> 这个预发布脚本去编译项目。</p><p>提交记录：<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/ZCp4qU>chore: config vsce package</a></p></blockquote><h3 id=打包原理><a href=#打包原理 class=headerlink title=打包原理></a>打包原理</h3><p>如过你也跟着一路敲到了这里，此时你会在项目根目录发现 <code>vsix</code> 结尾的文件：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f2c0846bd66747ceab0c09524a209b28~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>这就是 vscode 插件的安装包，我们先不急着安装，先一起来看一下这个文件是个什么东西。尝试用归档工具解压后得到如下目录文件夹：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/182c365a0690467cb0bd8b0d1490c175~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>我们可以看到编译后的文件夹 <code>out</code> 和其他一些文件是被直接压缩进安装包的，聪明的你肯定发现了 <code>.cz-config.js</code>、<code>.prettierrc.js</code> 和 <code>commitlint.config.js</code> 这种开发时文件也被压缩了，运行插件完全用不到，这明显不合理。其实和其他插件体系一样，vscode 也提供了 <code>.vscodeignore</code> 来实现打包忽略配置，我们将以上无关文件忽略重新打包即可。</p><p>原理就这？不存在的，我们打开 <code>extension.js</code> 会发现引用了 <code>vscode</code> 这个包：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb42881e49a94456aeac417f6b5cba71~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>但是我们的安装包中并没有 <em>node_modules</em>，那么 vscode 这个包存在在哪里呢？我猜的是挂在 node 环境上了，读了<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/33GTcH>源码</a>后我发现我竟然是对的：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e796fcf81b64fd7a18d9c3e36fbefdf~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>vscode 实现了拦截器在加载 Node 环境的时候将 vscode 给添加到了内置包中，这样的好处是减小插件的体积。</p><p>那么我们如果使用三方插件呢？以常用的 lodash 为例，安装 lodash 之后重新打包：</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line>$ yarn package</span><br><span class=line>yarn run v1.22.10</span><br><span class=line>$ vsce package --no-yarn</span><br><span class=line>Executing prepublish script <span class=string>&#x27;npm run vscode:prepublish&#x27;</span>...</span><br><span class=line></span><br><span class=line>&gt; juejin-posts@0.0.1 vscode:prepublish</span><br><span class=line>&gt; yarn run compile</span><br><span class=line></span><br><span class=line>$ tsc -p ./</span><br><span class=line>This extension consists of 1060 files, out of <span class=built_in>which</span> 1049 are JavaScript files. For performance reasons, you should bundle your extension: https://aka.ms/vscode-bundle-extension . You should also exclude unnecessary files by adding them to your .vscodeignore: https://aka.ms/vscode-vscodeignore</span><br><span class=line> DONE  Packaged: /Users/luozhu/Desktop/playground/juejin-posts/juejin-posts-0.0.1.vsix (1060 files, 644.72KB)</span><br><span class=line>✨  Done <span class=keyword>in</span> 5.54s.</span><br></pre></td></tr></table></figure><p>这个时候提示我们有 1000 多个文件，大概率 <em>node_modules</em> 文件夹被打包了，我们来解压下见证一下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/917b7742991640c9a0b03314cef24ce6~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>不出所料，vscode 默认的打包方式就是简单的编译拷贝，通过忽略文件减小体积也是杯水车薪。而且 vscode 扩展的规模往往增长很快。它们是在多个源文件中编写的，并依赖于 npm 的模块。分解和重用是开发的最佳实践，但在安装和运行扩展时，它们是有代价的。加载 100 个小文件要比加载一个大文件慢得多。这就是我们推荐捆绑的原因。捆绑是将多个小的源文件合并成一个文件的过程。</p><p>在 JavaScript 中，有不同的打包工具可以用，流行的有 rollup.js、Parcel、esbuild 和 webpack，官方脚手架默认只能选 webpack，我们这里推荐直接使用更快更强的 esbuild。</p><blockquote><p>提交记录：<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/ZCp4qU>chore: ignore config file when package</a>、<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/ggpQmv>chore: add esModuleInterop to tsconfig</a></p></blockquote><h3 id=使用-esbuild-优化打包><a href=#使用-esbuild-优化打包 class=headerlink title="使用 esbuild 优化打包"></a>使用 esbuild 优化打包</h3><p><strong>安装依赖：</strong></p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>$ yarn add -D esbuild</span><br></pre></td></tr></table></figure><p><strong>npm scripts：</strong></p><figure class="highlight diff"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line>&quot;scripts&quot;: &#123;</span><br><span class=line><span class=deletion>-    &quot;vscode:prepublish&quot;: &quot;yarn run compile&quot;,</span></span><br><span class=line><span class=deletion>-    &quot;compile&quot;: &quot;tsc -p ./&quot;,</span></span><br><span class=line><span class=deletion>-    &quot;watch&quot;: &quot;tsc -watch -p ./&quot;,</span></span><br><span class=line><span class=deletion>-    &quot;pretest&quot;: &quot;yarn run compile &amp;&amp; yarn run lint&quot;,</span></span><br><span class=line><span class=addition>+    &quot;vscode:prepublish&quot;: &quot;yarn esbuild-base --minify&quot;,</span></span><br><span class=line><span class=addition>+    &quot;esbuild-base&quot;: &quot;esbuild ./src/extension.ts --bundle --outfile=out/extension.js --external:vscode --format=cjs --platform=node&quot;,</span></span><br><span class=line><span class=addition>+    &quot;esbuild&quot;: &quot;yarn esbuild-base --sourcemap&quot;,</span></span><br><span class=line><span class=addition>+    &quot;esbuild-watch&quot;: &quot;yarn esbuild-base --sourcemap --watch&quot;,</span></span><br><span class=line><span class=addition>+    &quot;test-compile&quot;: &quot;tsc -p ./&quot;,</span></span><br><span class=line><span class=addition>+    &quot;pretest&quot;: &quot;yarn test-compile &amp;&amp; yarn lint&quot;,</span></span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意：由于 watch 改成了 esbuild-watch，所以 <em>.vscode/tasks.json</em> 中的 scripts 子段也需要做相应修改。</p></blockquote><p><strong>vscode tasks：</strong></p><p>理论上我们把打包命令改成 esbuild 之后，应该将 vscode 任务中的问题匹配程序设置为 <code>$esbuild-watch</code>，但是 vscode 会提示我们无法识别的问题匹配程序：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b51c79ee1344b6f92a3f2efaf9ef7aa~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>尝试搜索扩展，果然有一个 esbuild Problem Matchers 插件，我们将其安装并添加 <code>&quot;connor4312.esbuild-problem-matchers&quot;</code> 到 <em>.vscode/extensions.json</em> 文件的 <code>recommendations</code> 中。</p><p><strong>忽略文件：</strong></p><p>我们使用 esbuild 打包后会将使用到的代码都打包进 <code>out/extension.js</code>，但是 vsce 的打包机制是不管你有没有用到都会把 <code>dependencies</code> 中的包打进安装包中，所以我们需要将 <em><em>node_modules</em></em> 忽略掉。</p><p><strong>成果展示：</strong></p><p>从图中我们可以看到，安装包的体积大大减小了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba86286be7fc41f4b8325a3e0be0d2d2~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><blockquote><p>提交记录：<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/F12xNk>chore: config esbuild</a></p></blockquote><h2 id=集成-umijs><a href=#集成-umijs class=headerlink title="集成 umijs"></a>集成 umijs</h2><h3 id=初始化-umi-项目><a href=#初始化-umi-项目 class=headerlink title="初始化 umi 项目"></a>初始化 umi 项目</h3><p>使用 umi 脚手架在根目录新建一个 <em>web</em> 目录。</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>$ <span class=built_in>mkdir</span> web &amp;&amp; <span class=built_in>cd</span> web</span><br></pre></td></tr></table></figure><p>通过官方工具创建项目：</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>$ yarn create @umijs/umi-app</span><br></pre></td></tr></table></figure><p>修改 <em>.umirc.ts</em> 配置：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> &#123; defineConfig, <span class="title class_">IConfig</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;umi&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class=line>  <span class=attr>nodeModulesTransform</span>: &#123;</span><br><span class=line>    <span class=attr>type</span>: <span class=string>&#x27;none&#x27;</span>,</span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=attr>routes</span>: [&#123; <span class=attr>path</span>: <span class=string>&#x27;/&#x27;</span>, <span class=attr>component</span>: <span class=string>&#x27;@/pages/index&#x27;</span> &#125;],</span><br><span class=line>  <span class=attr>fastRefresh</span>: &#123;&#125;, <span class=comment>// 开发时可以保持组件状态，同时编辑提供即时反馈。</span></span><br><span class=line>  <span class=attr>history</span>: &#123;</span><br><span class=line>    <span class=attr>type</span>: <span class=string>&#x27;memory&#x27;</span>, <span class=comment>// 默认的类型是 `browser`，但是由于 vscode webview 环境不存在浏览器路由，改成 `memory` 和 `hash` 都可以</span></span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=attr>devServer</span>: &#123;</span><br><span class=line>    <span class=comment>// 需要在 dev 时写文件到输出目录，这样保证开发阶段有 js/css 文件</span></span><br><span class=line>    <span class=attr>writeToDisk</span>: <span class=function><span class=params>filePath</span> =&gt;</span></span><br><span class=line>      [<span class=string>&#x27;umi.js&#x27;</span>, <span class=string>&#x27;umi.css&#x27;</span>].<span class="title function_">some</span>(<span class=function><span class=params>name</span> =&gt;</span> filePath.<span class="title function_">endsWith</span>(name)),</span><br><span class=line>  &#125;,</span><br><span class=line>&#125; <span class=keyword>as</span> <span class="title class_">IConfig</span>);</span><br></pre></td></tr></table></figure><p>修改 <code>package.json</code> 加入 <code>name</code>、<code>version</code>、<code>description</code>：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;web&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;version&quot;</span><span class=punctuation>:</span> <span class=string>&quot;0.0.0&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;web for juejin-posts&quot;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h3 id=忽略文件><a href=#忽略文件 class=headerlink title=忽略文件></a>忽略文件</h3><p><strong>.gitignore：</strong></p><p>将 vscode 扩展和 umijs 脚手架生成的 gitignore 合并为一下内容：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br></pre></td><td class=code><pre><span class=line># See https://help.github.com/articles/ignoring-files/ for more about ignoring files.</span><br><span class=line></span><br><span class=line># vscode</span><br><span class=line>.vscode-test/</span><br><span class=line>*.vsix</span><br><span class=line></span><br><span class=line># dependencies</span><br><span class=line>node_modules</span><br><span class=line>npm-debug.log</span><br><span class=line>yarn-error.log</span><br><span class=line>package-lock.json</span><br><span class=line></span><br><span class=line># production</span><br><span class=line>out</span><br><span class=line>dist</span><br><span class=line></span><br><span class=line># misc</span><br><span class=line>.DS_Store</span><br><span class=line></span><br><span class=line># umi</span><br><span class=line>**/src/.umi</span><br><span class=line>**/src/.umi-production</span><br><span class=line>**/src/.umi-test</span><br><span class=line>**/.env.local</span><br><span class=line>web/yarn.lock</span><br></pre></td></tr></table></figure><p><strong>.vscodeignore：</strong></p><p>由于 vscode 打包的时候只需要获取 umijs 打包后的产物，所有加入 <code>web/**</code> 和 <code>!web/dist/**</code> 将无用的文件忽略掉。</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line>.vscode/**</span><br><span class=line>.vscode-test/**</span><br><span class=line>out/test/**</span><br><span class=line></span><br><span class=line>src/**</span><br><span class=line>.gitignore</span><br><span class=line>.yarnrc</span><br><span class=line>vsc-extension-quickstart.md</span><br><span class=line>**/tsconfig.json</span><br><span class=line>**/*.map</span><br><span class=line>**/*.ts</span><br><span class=line></span><br><span class=line>.cz-config.js</span><br><span class=line>.prettierrc.js</span><br><span class=line>.commitlintrc.js</span><br><span class=line>**/node_modules/**</span><br><span class=line>yarn-error.log</span><br><span class=line>web/**</span><br><span class=line>!web/dist/**</span><br></pre></td></tr></table></figure><h3 id=yarn-workspace><a href=#yarn-workspace class=headerlink title="yarn workspace"></a>yarn workspace</h3><p>由于我们的项目是 vscode 扩展和 web 项目混合的项目。为了方便管理脚本和依赖，我们引入了 <code>yarn workspace</code> 来管理项目。在根目录的 <em>package.json</em> 中加入以下配置即可：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;private&quot;</span><span class=punctuation>:</span> <span class=string>&quot;true&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;workspaces&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;web&quot;</span><span class=punctuation>]</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h3 id=调试-1><a href=#调试-1 class=headerlink title=调试></a>调试</h3><p>由于我们的 web 项目也需要编译，所以我们需要修改一下 vscode <code>launch.json</code> 加入 web 项目的编译任务。配置参考了 <a target=_blank rel="noopener external nofollow noreferrer" href=http://tny.im/bOqQT>appworks</a>。</p><p>首先在根目录的 <code>package.json</code> 的 scripts 中添加:</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;scripts&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;web-build&quot;</span><span class=punctuation>:</span> <span class=string>&quot;yarn workspace web run build&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;web-watch&quot;</span><span class=punctuation>:</span> <span class=string>&quot;yarn workspace web run start&quot;</span></span><br><span class=line>  <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p>然后修改 <em>.vscode/launch.json</em> 配置为：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// A launch configuration that compiles the extension and then opens it inside a new window</span></span><br><span class=line><span class=comment>// Use IntelliSense to learn about possible attributes.</span></span><br><span class=line><span class=comment>// Hover to view descriptions of existing attributes.</span></span><br><span class=line><span class=comment>// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;version&quot;</span><span class=punctuation>:</span> <span class=string>&quot;0.2.0&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;compounds&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>    <span class=comment>// 复合列表。每个复合可引用多个配置，这些配置将一起启动。</span></span><br><span class=line>    <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Debug Extension&quot;</span><span class=punctuation>,</span> <span class=comment>// 复合的名称。在启动配置下拉菜单中显示。</span></span><br><span class=line>      <span class=attr>&quot;configurations&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=comment>// 将作为此复合的一部分启动的配置名称。</span></span><br><span class=line>        <span class=string>&quot;Run Extension&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=string>&quot;Watch Webview&quot;</span></span><br><span class=line>      <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;presentation&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;order&quot;</span><span class=punctuation>:</span> <span class=number>0</span></span><br><span class=line>      <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line>  <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;configurations&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>    <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Watch Webview&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;request&quot;</span><span class=punctuation>:</span> <span class=string>&quot;attach&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;node&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;preLaunchTask&quot;</span><span class=punctuation>:</span> <span class=string>&quot;npm: web-watch&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Run Extension&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;extensionHost&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;request&quot;</span><span class=punctuation>:</span> <span class=string>&quot;launch&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;args&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;--extensionDevelopmentPath=$&#123;workspaceFolder&#125;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;outFiles&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;$&#123;workspaceFolder&#125;/out/**/*.js&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;preLaunchTask&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$&#123;defaultBuildTask&#125;&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line>  <span class=punctuation>]</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p>完成后进入 VS Code，按下<code>F5</code>，你会立即看到一个<strong>插件发开主机</strong>窗口，其中就运行着插件。这时候运行你会发现控制台报一下错误 ❌：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>error TS6059: File &#x27;/Users/luozhu/Desktop/github/juejin-posts/web/src/pages/index.tsx&#x27; is not under &#x27;rootDir&#x27; &#x27;/Users/luozhu/Desktop/github/juejin-posts/src&#x27;. &#x27;rootDir&#x27; is expected to contain all source files.</span><br><span class=line>  The file is in the program because:</span><br><span class=line>    Matched by include pattern &#x27;**/*&#x27; in &#x27;/Users/luozhu/Desktop/github/juejin-posts/tsconfig.json&#x27;</span><br></pre></td></tr></table></figure><p>原因是因为 umi 的约定的项目结构和 vscode extension 都包含 <em>src</em> 目录。由于 vscode 插件和 umi 的编译是分开的，我们在根目录的 <em>tsconfig.json</em> 中将 <em>web</em> 目录忽略即可：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;exclude&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;web&quot;</span><span class=punctuation>]</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p>现在，你可以按下 <code>F5</code> 看到<strong>插件发开主机</strong>窗口的同时还会看到两个调试任务：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4b3b6f2522643fb9bc574e2f9982775~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><blockquote><p>注意📢：请选择 Debug Extension 调试任务而不是 Run Extension</p></blockquote><h3 id=其他优化工作><a href=#其他优化工作 class=headerlink title=其他优化工作></a>其他优化工作</h3><ol><li>由于基于 yarn workspace，我们把公用的依赖合并</li><li>合并 Eslint 配置并使用 <code>@luozhu/eslint-config-react-typescrip</code></li><li>合并 Editorconfig 和 Prettier 配置</li><li>添加 <code>prestart</code> 和 <code>prebuild</code> script</li><li>设置 <code>HTML=none umi build</code></li></ol><blockquote><p>提交记录：<a target=_blank rel="noopener external nofollow noreferrer" href=https://is.gd/bt3WHr>chore: config umijs</a></p></blockquote><h2 id=vscode-插件开发核心概念><a href=#vscode-插件开发核心概念 class=headerlink title="vscode 插件开发核心概念"></a>vscode 插件开发核心概念</h2><p>在开始 webview 能力开发之前，我们有必要了解一下 vscode 插件开发的核心概念。为了有个全局的理解，我们先来看下我们现在项目的主要目录结构：</p><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>.</span><br><span class=line>├── CHANGELOG.md <span class=comment># 基于 standard-version 生成的更新日志文件</span></span><br><span class=line>├── README.md</span><br><span class=line>├── package.json <span class=comment># vscode 包配置文件，诸如插件 LOGO、名字、描述、注册激活事件</span></span><br><span class=line>├── src</span><br><span class=line>│   └── extension.ts <span class=comment># 插件入口文件，暴露 activate 方法用于注册命令和初始化一些配置，暴露 deactivate 方法用于插件关闭前执行清理工作</span></span><br><span class=line>├── tsconfig.json <span class=comment># vscode 的编译配置</span></span><br><span class=line>├── web <span class=comment># 基于 umi 的 web，也是我们后边 webview 要承载的内容</span></span><br><span class=line>└── yarn.lock</span><br></pre></td></tr></table></figure><p>从目录结构可以看出，关键的文件是 <code>package.json</code> 和 <code>extension.ts</code>，我们以 helloWorld 命令为例介绍下 vscode 插件的三个核心概念。</p><h3 id=1-激活事件><a href=#1-激活事件 class=headerlink title="1. 激活事件"></a>1. 激活事件</h3><p><strong>激活事件</strong>是在 <code>package.json</code> 中的 <code>activationEvents</code> 字段声明的一个 JSON 数组对象。为了注册 helloWorld 这个命令，第一步就是注册激活事件，激活事件类型有很多，注册命令的激活事件是 <code>onCommand</code>:</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;activationEvents&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;onCommand:juejin-posts.helloWorld&quot;</span><span class=punctuation>]</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h3 id=2-发布内容配置><a href=#2-发布内容配置 class=headerlink title="2. 发布内容配置"></a>2. 发布内容配置</h3><p>发布内容配置（ 即 VS Code 为插件扩展提供的配置项）是 <code>package.json</code> 的 <code>contributes</code> 字段，你可以在其中注册各种配置项扩展 VS Code 的能力。上一步我们注册的 helloWorld 激活事件只是告诉了 vscode 可以通过 <code>juejin-posts.helloWorld</code> 命令触发。我们还需要再 <code>contributes.commands</code> 中注册我们的 <code>juejin-posts.helloWorld</code> 命令：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;contributes&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;commands&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;juejin-posts.helloWorld&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Hello World&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>]</span></span><br><span class=line>  <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h3 id=3-VS-Code-API><a href=#3-VS-Code-API class=headerlink title="3. VS Code API"></a>3. VS Code API</h3><p><strong>VS Code API</strong> 是 VS Code 提供给插件使用的一系列 Javascript API。通过前两个核心概念的能力，我们已经注册好了命令和事件，那么下一步必然就是注册事件回调。事件回调在 vscode 中是通过 <code>vscode.commands.registerCommand</code> 函数来注册的，下面 👇🏻 是我们在入口文件 <code>src/extension.ts</code> 中注册 <code>juejin-posts.helloWorld</code> 命令。</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// vscode 这个模块包含了 VS Code 扩展的 API</span></span><br><span class=line><span class=keyword>import</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=comment>// 这个方法当你的扩展激活时调用，扩展会在命令首次执行时激活</span></span><br><span class=line><span class=keyword>export</span> <span class=keyword>function</span> <span class="title function_">activate</span>(<span class=params>context: vscode.ExtensionContext</span>) &#123;</span><br><span class=line>  <span class=comment>// 当你的扩展被激活时，这行代码将只被执行一次</span></span><br><span class=line>  <span class=comment>//</span></span><br><span class=line>  <span class=comment>// 使用 console.log 输出日志信息或使用 console.error 输出错误信息。</span></span><br><span class=line>  <span class=comment>//</span></span><br><span class=line>  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;Congratulations, your extension &quot;juejin-posts&quot; is now active!&#x27;</span>);</span><br><span class=line></span><br><span class=line>  <span class=comment>// 入口命令已经在 package.json 文件中定义好了，现在调用 registerCommand 方法</span></span><br><span class=line>  <span class=comment>// registerCommand 中的参数必须与 package.json 中的 command 保持一致</span></span><br><span class=line>  <span class=keyword>const</span> disposable = vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;juejin-posts.helloWorld&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>    <span class=comment>// 把你的代码写在这里，每次命令执行时都会调用这里的代码</span></span><br><span class=line>    <span class=comment>// 给用户显示一个消息提示</span></span><br><span class=line>    vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>&#x27;Hello World from Juejin Posts!&#x27;</span>);</span><br><span class=line>  &#125;);</span><br><span class=line></span><br><span class=line>  context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(disposable);</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 当你的扩展被停用时，这个方法被调用。</span></span><br><span class=line><span class=keyword>export</span> <span class=keyword>function</span> <span class="title function_">deactivate</span>(<span class=params></span>) &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id=集成-webview><a href=#集成-webview class=headerlink title="集成 webview"></a>集成 webview</h2><h3 id=注册命令><a href=#注册命令 class=headerlink title=注册命令></a>注册命令</h3><p>1、<em>package.json</em> 激活事件（<code>activationEvents</code>）中添加 <code>&quot;onCommand:juejin-posts.start&quot;</code></p><p>2、<em>package.json</em> 命令（<code>commands</code>）中添加：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;juejin-posts.start&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;start&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Juejin Posts&quot;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p>3、<em>src/extension.ts</em> 中注册命令</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line>context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(</span><br><span class=line>  vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;juejin-posts.start&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>    <span class=comment>// Truth is endless. Keep coding...</span></span><br><span class=line>  &#125;)</span><br><span class=line>)</span><br></pre></td></tr></table></figure><h3 id=创建-webview-面板><a href=#创建-webview-面板 class=headerlink title="创建 webview 面板"></a>创建 webview 面板</h3><h4 id=创建一个空白的面板><a href=#创建一个空白的面板 class=headerlink title=创建一个空白的面板></a>创建一个空白的面板</h4><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=comment>// 创建并显示新的webview</span></span><br><span class=line><span class=keyword>const</span> panel = vscode.<span class=property>window</span>.<span class="title function_">createWebviewPanel</span>(</span><br><span class=line>  <span class=string>&#x27;juejin-posts&#x27;</span>, <span class=comment>// 只供内部使用，这个 webview 的标识</span></span><br><span class=line>  <span class=string>&#x27;Juejin Posts&#x27;</span>, <span class=comment>// 给用户显示的面板标题</span></span><br><span class=line>  vscode.<span class=property>vscode</span>.<span class=property>ViewColumn</span>.<span class=property>One</span>, <span class=comment>// 给新的 webview 面板一个编辑器视图</span></span><br><span class=line>  &#123;</span><br><span class=line>    <span class=attr>enableScripts</span>: <span class=literal>true</span>, <span class=comment>// 启用 javascript 脚本</span></span><br><span class=line>    <span class=attr>retainContextWhenHidden</span>: <span class=literal>true</span>, <span class=comment>// 隐藏时保留上下文</span></span><br><span class=line>  &#125; <span class=comment>// webview 面板的内容配置</span></span><br><span class=line>);</span><br></pre></td></tr></table></figure><p>我们使用了 <a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api.js.org/modules/window.html#createWebviewPanel>window.createWebviewPanel</a> API 创建了一个 webview 面板，现在我们尝试运行 <code>juejin-posts.start</code> 就可以打开一个 webview 面板：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d85ad985232542f587376e5073feb1a1~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><h4 id=给面板设置内容><a href=#给面板设置内容 class=headerlink title=给面板设置内容></a>给面板设置内容</h4><p>上面我们创建了一个空白的面板，那么我们如何给面板添加内容呢？我们可以使用 <code>panel.webview.html</code> 来设置 HTML 内容：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>function</span> <span class="title function_">getWebviewContent</span>(<span class=params></span>) &#123;</span><br><span class=line>  <span class=keyword>return</span> <span class=string>`</span></span><br><span class=line><span class=string>    &lt;!DOCTYPE html&gt;</span></span><br><span class=line><span class=string>    &lt;html lang=&quot;en&quot;&gt;</span></span><br><span class=line><span class=string>    &lt;head&gt;</span></span><br><span class=line><span class=string>        &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class=line><span class=string>        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class=line><span class=string>        &lt;title&gt;Juejin Posts&lt;/title&gt;</span></span><br><span class=line><span class=string>        &lt;style&gt;</span></span><br><span class=line><span class=string>          html, body &#123;</span></span><br><span class=line><span class=string>            padding: 0px;</span></span><br><span class=line><span class=string>            height: 100vh;</span></span><br><span class=line><span class=string>            position: relative;</span></span><br><span class=line><span class=string>            margin: 0;</span></span><br><span class=line><span class=string>            padding: 0;</span></span><br><span class=line><span class=string>            overflow: hidden;</span></span><br><span class=line><span class=string>          &#125;</span></span><br><span class=line><span class=string>          #yoyo &#123;</span></span><br><span class=line><span class=string>            position: absolute;</span></span><br><span class=line><span class=string>            bottom: 50px;</span></span><br><span class=line><span class=string>            right: -90px;</span></span><br><span class=line><span class=string>            opacity: 0;</span></span><br><span class=line><span class=string>            transition: .25s ease-in-out</span></span><br><span class=line><span class=string>          &#125;</span></span><br><span class=line><span class=string>          #yoyo:hover &#123;</span></span><br><span class=line><span class=string>            opacity: 1;</span></span><br><span class=line><span class=string>            right: 0;</span></span><br><span class=line><span class=string>          &#125;</span></span><br><span class=line><span class=string>        &lt;/style&gt;</span></span><br><span class=line><span class=string>    &lt;/head&gt;</span></span><br><span class=line><span class=string>    &lt;body&gt;</span></span><br><span class=line><span class=string>      &lt;a href=&quot;https://juejin.cn&quot;&gt;&lt;img id=&quot;yoyo&quot; src=&quot;https://cdn.jsdelivr.net/gh/youngjuning/images/20210817163229.png&quot; width=&quot;100&quot; /&gt;&lt;/a&gt;</span></span><br><span class=line><span class=string>    &lt;/body&gt;</span></span><br><span class=line><span class=string>    &lt;/html&gt;</span></span><br><span class=line><span class=string>  `</span>;</span><br><span class=line>&#125;</span><br><span class=line>...</span><br><span class=line><span class=comment>// 给 webview panel 设置 HTML 内容</span></span><br><span class=line>panel.<span class=property>webview</span>.<span class=property>html</span> = <span class="title function_">getWebviewContent</span>();</span><br><span class=line>...</span><br></pre></td></tr></table></figure><p>重新使用 <code>juejin-posts.start</code> 命令就可以调戏悠悠船长了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5160d0c76536441b8d1ac3cfcedc0d0e~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><h4 id=限制-webview-视图为一个><a href=#限制-webview-视图为一个 class=headerlink title="限制 webview 视图为一个"></a>限制 webview 视图为一个</h4><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>export</span> <span class=keyword>function</span> <span class="title function_">activate</span>(<span class=params>context: vscode.ExtensionContext</span>) &#123;</span><br><span class=line>  <span class=comment>// 追踪当前 webview 面板</span></span><br><span class=line>  <span class=keyword>let</span> <span class=attr>currentPanel</span>: vscode.<span class=property>WebviewPanel</span> | <span class=literal>undefined</span> = <span class=literal>undefined</span>;</span><br><span class=line></span><br><span class=line>  context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(</span><br><span class=line>    vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;juejin-posts.start&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>      <span class=comment>// 获取当前活动的编辑器</span></span><br><span class=line>      <span class=keyword>const</span> columnToShowIn = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span></span><br><span class=line>        ? vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>.<span class=property>viewColumn</span></span><br><span class=line>        : <span class=literal>undefined</span>;</span><br><span class=line></span><br><span class=line>      <span class=keyword>if</span> (currentPanel) &#123;</span><br><span class=line>        <span class=comment>// 如果我们已经有了一个面板，那就把它显示到目标列布局中</span></span><br><span class=line>        currentPanel.<span class="title function_">reveal</span>(columnToShowIn);</span><br><span class=line>      &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>        <span class=comment>// 不然，创建一个新面板</span></span><br><span class=line>        currentPanel = vscode.<span class=property>window</span>.<span class="title function_">createWebviewPanel</span>();</span><br><span class=line>        <span class=comment>// 当前面板被关闭后重置</span></span><br><span class=line>        currentPanel.<span class="title function_">onDidDispose</span>(</span><br><span class=line>          <span class=function>() =&gt;</span> &#123;</span><br><span class=line>            currentPanel = <span class=literal>undefined</span>;</span><br><span class=line>          &#125;,</span><br><span class=line>          <span class=literal>null</span>,</span><br><span class=line>          context.<span class=property>subscriptions</span></span><br><span class=line>        );</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;)</span><br><span class=line>  );</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><ul><li><a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/modules/window.html#activeTextEditor>vscode.window.activeTextEditor</a>：获取当前活动的文本编辑器</li><li><a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/interfaces/WebviewPanel.html#reveal>currentPanel.reveal()</a>：调用 <code>reveal()</code> 或者拖动 webview 面板到新的编辑布局中去。</li></ul><h4 id=设置-Icon><a href=#设置-Icon class=headerlink title="设置 Icon"></a>设置 Icon</h4><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 设置 Logo</span></span><br><span class=line>panel.<span class=property>iconPath</span> = vscode.<span class=property>Uri</span>.<span class="title function_">file</span>(</span><br><span class=line>  path.<span class="title function_">join</span>(context.<span class=property>extensionPath</span>, <span class=string>&#x27;assets&#x27;</span>, <span class=string>&#x27;icon-juejin.png&#x27;</span>)</span><br><span class=line>);</span><br></pre></td></tr></table></figure><p>在 vscode 扩展中我们需要通过 <code>vscode.Uri.file</code> 方法获取磁盘上的资源路径。</p><h4 id=webview-获取内容的-Uri><a href=#webview-获取内容的-Uri class=headerlink title="webview 获取内容的 Uri"></a>webview 获取内容的 Uri</h4><p>你应该使用 <code>asWebviewUri</code> 管理插件资源。不要硬编码 <code>vscode-resource://</code>，而是使用 <code>asWebviewUri</code> 确保你的插件在云端环境也能正常运行。</p><p>在 <a target=_blank rel="noopener external nofollow noreferrer" href=http://tny.im/jb4go>@luozhu/vscode-utils</a> 中我们对获取本地资源路径做了封装：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 获取内容的 Uri</span></span><br><span class=line><span class=keyword>const</span> <span class="title function_">getDiskPath</span> = (<span class=params>fileName: <span class=built_in>string</span></span>) =&gt; &#123;</span><br><span class=line>  <span class=keyword>return</span> webviewPanel.<span class=property>webview</span>.<span class="title function_">asWebviewUri</span>(</span><br><span class=line>    vscode.<span class=property>Uri</span>.<span class="title function_">file</span>(path.<span class="title function_">join</span>(context.<span class=property>extensionPath</span>, rootPath, <span class=string>&#x27;dist&#x27;</span>, fileName))</span><br><span class=line>  );</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><h3 id=使用-umi-开发-webview><a href=#使用-umi-开发-webview class=headerlink title="使用 umi 开发 webview"></a>使用 umi 开发 webview</h3><p>上一节我们通过调戏悠悠船长熟悉了 webview 面板的创建，这一节我们来看下如何使用 umijs 来代替 HTML 的内容。</p><p><code>panel.webview.html</code> 中的内容其实就是正常的 HTML+JavaScript+CSS 代码。你可以使用任何前端技术去编写它的内容，比如 jquery、bootstrap、Vue 以及 React。虽然本文的例子是基于 umijs 开发 webview 的内容，但是其他技术原理是一样的，洛竹在后续也会提供多个技术的 vscode webview 开发脚手架。</p><h4 id=封装获取-umijs-打包产物的方法><a href=#封装获取-umijs-打包产物的方法 class=headerlink title="封装获取 umijs 打包产物的方法"></a>封装获取 umijs 打包产物的方法</h4><p>我们知道 <code>umi build</code> 命令会在 <em>web/dist</em> 产生 index.html、umi.js、umi.css 三个文件，我们根据 index.html 改造前面的 getWebviewContent 方法如下：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> path <span class=keyword>from</span> <span class=string>&#x27;path&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=comment>/**</span></span><br><span class=line><span class=comment> * 获取基于 umijs 的 webview 内容</span></span><br><span class=line><span class=comment> * <span class=doctag>@param</span> context 扩展上下文</span></span><br><span class=line><span class=comment> * <span class=doctag>@param</span> webviewPanel webview 面板对象</span></span><br><span class=line><span class=comment> * <span class=doctag>@param</span> rootPath webview 所在路径，默认 web</span></span><br><span class=line><span class=comment> * <span class=doctag>@param</span> umiVersion umi 版本</span></span><br><span class=line><span class=comment> * <span class=doctag>@returns</span> <span class=variable>string</span></span></span><br><span class=line><span class=comment> */</span></span><br><span class=line><span class=keyword>export</span> <span class=keyword>const</span> <span class="title function_">getUmiContent</span> = (<span class=params></span></span><br><span class=line><span class=params>  context: vscode.ExtensionContext,</span></span><br><span class=line><span class=params>  webviewPanel: vscode.WebviewPanel,</span></span><br><span class=line><span class=params>  umiVersion?: <span class=built_in>string</span>,</span></span><br><span class=line><span class=params>  rootPath = <span class=string>&#x27;web&#x27;</span></span></span><br><span class=line><span class=params></span>) =&gt; &#123;</span><br><span class=line>  <span class=comment>// 获取磁盘上的资源路径</span></span><br><span class=line>  <span class=keyword>const</span> <span class="title function_">getDiskPath</span> = (<span class=params>fileName: <span class=built_in>string</span></span>) =&gt; &#123;</span><br><span class=line>    <span class=keyword>return</span> webviewPanel.<span class=property>webview</span>.<span class="title function_">asWebviewUri</span>(</span><br><span class=line>      vscode.<span class=property>Uri</span>.<span class="title function_">file</span>(path.<span class="title function_">join</span>(context.<span class=property>extensionPath</span>, rootPath, <span class=string>&#x27;dist&#x27;</span>, fileName))</span><br><span class=line>    );</span><br><span class=line>  &#125;;</span><br><span class=line>  <span class=keyword>return</span> <span class=string>`</span></span><br><span class=line><span class=string>    &lt;html&gt;</span></span><br><span class=line><span class=string>      &lt;head&gt;</span></span><br><span class=line><span class=string>        &lt;meta charset=&quot;utf-8&quot; /&gt;</span></span><br><span class=line><span class=string>        &lt;meta</span></span><br><span class=line><span class=string>          name=&quot;viewport&quot;</span></span><br><span class=line><span class=string>          content=&quot;width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no&quot;</span></span><br><span class=line><span class=string>        /&gt;</span></span><br><span class=line><span class=string>        &lt;link rel=&quot;stylesheet&quot; href=&quot;<span class=subst>$&#123;getDiskPath(<span class=string>&#x27;umi.css&#x27;</span>)&#125;</span>&quot; /&gt;</span></span><br><span class=line><span class=string>        &lt;style&gt;</span></span><br><span class=line><span class=string>          html, body, #root &#123;</span></span><br><span class=line><span class=string>            width: 100%;</span></span><br><span class=line><span class=string>            height: 100%;</span></span><br><span class=line><span class=string>            margin: 0;</span></span><br><span class=line><span class=string>            padding: 0;</span></span><br><span class=line><span class=string>            overflow: hidden;</span></span><br><span class=line><span class=string>          &#125;</span></span><br><span class=line><span class=string>        &lt;/style&gt;</span></span><br><span class=line><span class=string>        &lt;script&gt;</span></span><br><span class=line><span class=string>          //! umi version: <span class=subst>$&#123;umiVersion&#125;</span></span></span><br><span class=line><span class=string>        &lt;/script&gt;</span></span><br><span class=line><span class=string>      &lt;/head&gt;</span></span><br><span class=line><span class=string>      &lt;body&gt;</span></span><br><span class=line><span class=string>        &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span><br><span class=line><span class=string>        &lt;script src=&quot;<span class=subst>$&#123;getDiskPath(<span class=string>&#x27;umi.js&#x27;</span>)&#125;</span>&quot;&gt;&lt;/script&gt;</span></span><br><span class=line><span class=string>      &lt;/body&gt;</span></span><br><span class=line><span class=string>    &lt;/html&gt;</span></span><br><span class=line><span class=string>  `</span>;</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>提示：上面的方法我已经封装在 <a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning/luozhu/tree/main/packages/vscode-utils>@luozhu/vscode-utils</a> 的中。</p></blockquote><p>我们使用 getUmiContent 重新前面的代码：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> &#123; getUmiContent &#125; <span class=keyword>from</span> <span class=string>&#x27;@luozhu/vscode-utils&#x27;</span>;</span><br><span class=line>...</span><br><span class=line>panel.<span class=property>webview</span>.<span class=property>html</span> = <span class="title function_">getUmiContent</span>(context, panel, <span class=string>&#x27;3.5.17&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id=优化打包><a href=#优化打包 class=headerlink title=优化打包></a>优化打包</h4><p>由于我们封装了 <code>getUmiContent</code> 方法，<code>umi build</code> 生成的 index.html 就没有用了，我们可以使用 <code>HTML=none umi build</code> 命令在打包的时候不生成 index.html 文件。</p><p>另外目前 <a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/umijs/umi/issues/7132>umijs 的 mfsu 不支持 writeToDisk 方法</a>，如果后续支持了可以使用 mfsu 优化调试速度。</p><blockquote><p>创建 webview 面板的任务大部分都比较重复，为了沉淀最佳实践，我在 <a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning/luozhu/tree/main/packages/vscode-utils>@luozhu/vscode-utils</a> 封装了 <a target=_blank rel="noopener external nofollow noreferrer" href=http://tny.im/bHLQx>createUmiWebviewPanel</a> 方法。</p></blockquote><h3 id=给-webview-内容加上主题><a href=#给-webview-内容加上主题 class=headerlink title="给 webview 内容加上主题"></a>给 webview 内容加上主题</h3><p>webview 可以基于当前的 VS Code 主题和 CSS 改变自身的样式。VS Code 将主题分成 3 种类别，而且在 body 元素上加上了特殊类名以表明当前主题，我们在 umi 中全局加入下面的样式：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre></td><td class=code><pre><span class=line>body.<span class=property>vscode</span>-light &#123;</span><br><span class=line>  h1, h2, h3, h4, h5, h6 &#123;</span><br><span class=line>    <span class=attr>color</span>: black;</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=attr>color</span>: black;</span><br><span class=line>  background-<span class=attr>color</span>: <span class="title function_">var</span>(--vscode-editor-background);</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line>body.<span class=property>vscode</span>-dark &#123;</span><br><span class=line>  h1, h2, h3, h4, h5, h6 &#123;</span><br><span class=line>    <span class=attr>color</span>: white;</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=attr>color</span>: white;</span><br><span class=line>  background-<span class=attr>color</span>: <span class="title function_">var</span>(--vscode-editor-background);</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line>body.<span class=property>vscode</span>-high-contrast &#123;</span><br><span class=line>  h1, h2, h3, h4, h5, h6 &#123;</span><br><span class=line>    <span class=attr>color</span>: red;</span><br><span class=line>  &#125;</span><br><span class=line>  <span class=attr>color</span>: red;</span><br><span class=line>  background-<span class=attr>color</span>: <span class="title function_">var</span>(--vscode-editor-background);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>由于这部分适配大部分是通用的，所以我也将它封装进了 <code>@luozhu/vscode-utils</code> 的 <code>getUmiContent</code> 中了。</p><h2 id=webview-与-vscode-交互><a href=#webview-与-vscode-交互 class=headerlink title="webview 与 vscode 交互"></a>webview 与 vscode 交互</h2><h3 id=webview-中执行脚本><a href=#webview-中执行脚本 class=headerlink title="webview 中执行脚本"></a>webview 中执行脚本</h3><p>vscode 中的 webview 本质就是一个 iframe，因此我们是可以再 webview 中执行脚本的，只不过在 vscode 中 webview 默认禁用了 JavaScript，我们在调用 <code>createWebviewPanel</code> API 时传入 <code>enableScripts: true</code> 即可。</p><h3 id=插件传递信息给-webview><a href=#插件传递信息给-webview class=headerlink title="插件传递信息给 webview"></a>插件传递信息给 webview</h3><p>webview 的脚本能做到任何普通网页脚本能做到的事情，但是 webview 运行在自己的上下文中，脚本是不能访问 VS Code API 的。我们需要借助 postMessage 这种事件的方式传递信息。在 vscode 中，我们在 vscode 侧可以使用 <a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/interfaces/Webview.html#postMessage>Webview.postMessage</a> 发布事件并发送任何序列化的 JSON 数据，在 webview 侧则使用 <code>window.addEventListener(&#39;message&#39; event =&gt; &#123; ... &#125;)</code> 来处理这些信息：</p><p><strong>vscode 侧</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 注册一个新的命令</span></span><br><span class=line>context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(</span><br><span class=line>  vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;juejin-me.author&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (!currentPanel) &#123;</span><br><span class=line>      <span class=keyword>return</span>;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    <span class=comment>// 把信息发送到 webview</span></span><br><span class=line>    <span class=comment>// 你可以发送任何序列化的 JSON 数据</span></span><br><span class=line>    currentPanel.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123; <span class=attr>method</span>: <span class=string>&#x27;showAuthor&#x27;</span> &#125;);</span><br><span class=line>  &#125;)</span><br><span class=line>);</span><br></pre></td></tr></table></figure><p><strong>webview 侧</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> &#123; <span class="title class_">Modal</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;antd&#x27;</span>;</span><br><span class=line>...</span><br><span class=line><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class=string>&#x27;message&#x27;</span>, <span class=function><span class=params>event</span> =&gt;</span> &#123;</span><br><span class=line>  <span class=keyword>const</span> message = event.<span class=property>data</span>;</span><br><span class=line>  <span class=keyword>switch</span> (message.<span class=property>method</span>) &#123;</span><br><span class=line>    <span class=keyword>case</span> <span class=string>&#x27;showAuthor&#x27;</span>: &#123;</span><br><span class=line>      <span class="title class_">Modal</span>.<span class="title function_">info</span>(&#123;</span><br><span class=line>        <span class=attr>title</span>: <span class=string>&#x27;洛竹&#x27;</span>,</span><br><span class=line>        <span class=attr>content</span>: (</span><br><span class=line>          <span class=language-xml><span class=tag>&lt;<span class=name>div</span>&gt;</span></span></span><br><span class=line><span class=language-xml>            大家好，我是洛竹🎋一只住在杭城的木系前端🧚🏻‍♀️，如果你喜欢我的文章📚，可以通过</span></span><br><span class=line><span class=language-xml>            <span class=tag>&lt;<span class=name>a</span> <span class=attr>href</span>=<span class=string>&quot;https://juejin.cn/user/325111174662855/posts&quot;</span>&gt;</span>点赞<span class=tag>&lt;/<span class=name>a</span>&gt;</span>帮我聚集灵力⭐️。</span></span><br><span class=line><span class=language-xml>          <span class=tag>&lt;/<span class=name>div</span>&gt;</span></span></span><br><span class=line>        ),</span><br><span class=line>        <span class=attr>okText</span>: <span class=language-xml><span class=tag>&lt;<span class=name>a</span> <span class=attr>href</span>=<span class=string>&quot;https://juejin.cn/user/325111174662855/posts&quot;</span>&gt;</span>点赞 o(￣▽￣)ｄ<span class=tag>&lt;/<span class=name>a</span>&gt;</span></span>,</span><br><span class=line>      &#125;);</span><br><span class=line>      <span class=keyword>break</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=attr>default</span>:</span><br><span class=line>      <span class=keyword>break</span>;</span><br><span class=line>  &#125;</span><br><span class=line>&#125;);</span><br></pre></td></tr></table></figure><p><strong>效果</strong>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0dd7dd37db954d84925ac1c0f60cb965~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><h3 id=webview-传递信息给插件><a href=#webview-传递信息给插件 class=headerlink title="webview 传递信息给插件"></a>webview 传递信息给插件</h3><p>webview 反向传递信息给插件的原理也是一样的，只不过由于 webview 的上下文限制，我们只能通过 <code>acquireVsCodeApi</code> 函数获取阉割版的 VS Code API 对象，这个阉割的对象上有一个 <code>postMessage</code> 函数可以供我们发送事件用。注意 <code>acquireVsCodeApi</code> 个会话中只能调用一次，重复调用会报错。而在插件侧则可以通过 <a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/interfaces/Webview.html#onDidReceiveMessage>Webview.onDidReceiveMessage</a> 处理 webview 传递的信息。我们来写一个在 webview 中调用 <code>vscode.window.showInformationMessage</code> 的例子：</p><p><strong>webview 侧</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>const</span> vscode = <span class="title function_">acquireVsCodeApi</span>();</span><br><span class=line>vscode.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>  <span class=attr>method</span>: <span class=string>&#x27;showMessage&#x27;</span>,</span><br><span class=line>  <span class=attr>params</span>: &#123;</span><br><span class=line>    <span class=attr>text</span>: <span class=string>`为人民服务`</span>,</span><br><span class=line>  &#125;,</span><br><span class=line>&#125;);</span><br></pre></td></tr></table></figure><p><strong>插件侧</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 处理 webview 中的信息</span></span><br><span class=line>currentPanel.<span class=property>webview</span>.<span class="title function_">onDidReceiveMessage</span>(</span><br><span class=line>  <span class=function><span class=params>message</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (message.<span class=property>method</span> === <span class=string>&#x27;showMessage&#x27;</span>) &#123;</span><br><span class=line>      vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(message.<span class=property>params</span>.<span class=property>content</span>);</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=literal>undefined</span>,</span><br><span class=line>  context.<span class=property>subscriptions</span></span><br><span class=line>);</span><br></pre></td></tr></table></figure><p><strong>效果</strong>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c32c8b374b534d6fac1cb552287de6ca~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><h3 id=在-webview-中请求接口><a href=#在-webview-中请求接口 class=headerlink title="在 webview 中请求接口"></a>在 webview 中请求接口</h3><p>一开始，我以为这是个轻松的工作，直到遇到跨域半天解决不了后我绝望了，在 <a target=_blank rel="noopener external nofollow noreferrer" href=https://juejin.cn/post/6844903966799577101#heading-3>VSCode WebView插件（扩展）开发实战</a> 一文中我终于知道了 vscode webview 内部是不允许发送 ajax 请求，所有 ajax 请求都是跨域的，因为 webview 本身是没有 host 的。</p><p>人裂开了，这什么鬼呀，我们核心的需求就是请求掘金的接口获取我们的文章列表呀，那我们还有办法吗？答案是肯定的，其实还是借助上面我们提到的通信机制把请求接口的任务交给 vscode 去处理，完事再让 vscode 把数据通过 <code>postMessage</code> 返回给我们，多说无益，我们来看代码：</p><p><strong>webview 侧</strong>：</p><figure class="highlight tsx"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre></td><td class=code><pre><span class=line><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class=function>() =&gt;</span> &#123;</span><br><span class=line>  <span class=comment>// @ts-ignore</span></span><br><span class=line>  <span class=keyword>const</span> vscode = <span class=keyword>typeof</span> acquireVsCodeApi === <span class=string>&#x27;function&#x27;</span> ? <span class="title function_">acquireVsCodeApi</span>() : <span class=literal>null</span>;</span><br><span class=line>  vscode.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>    <span class=attr>method</span>: <span class=string>&#x27;queryPosts&#x27;</span>,</span><br><span class=line>  &#125;);</span><br><span class=line>  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class=string>&#x27;message&#x27;</span>, <span class=function><span class=params>event</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (method === <span class=string>&#x27;queryPosts&#x27;</span>) &#123;</span><br><span class=line>      <span class=keyword>const</span> message = event.<span class=property>data</span>;</span><br><span class=line>      <span class="variable language_">console</span>.<span class="title function_">log</span>(message);</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;);</span><br><span class=line>&#125;, []);</span><br></pre></td></tr></table></figure><p><strong>vscode 侧</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 处理 webview 中的信息，并返回接口请求的数据</span></span><br><span class=line>currentPanel.<span class=property>webview</span>.<span class="title function_">onDidReceiveMessage</span>(</span><br><span class=line>  <span class=keyword>async</span> message =&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> data = <span class=keyword>await</span> <span class="title function_">events</span>(message);</span><br><span class=line>    currentPanel?.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123; data &#125;);</span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=literal>undefined</span>,</span><br><span class=line>  context.<span class=property>subscriptions</span></span><br><span class=line>);</span><br></pre></td></tr></table></figure><h3 id=luozhu-vscode-channel><a href=#luozhu-vscode-channel class=headerlink title=@luozhu/vscode-channel></a>@luozhu/vscode-channel</h3><p>前面我们知道了使用 <a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/interfaces/Webview.html#postMessage>Webview.postMessage</a>、<a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/interfaces/Webview.html#onDidReceiveMessage>Webview.onDidReceiveMessage</a>、<code>acquireVsCodeApi().postMessage</code> 和 <code>window.addEventListener</code> 就可以满足各种通信需求了，那 <code>@luozhu/vscode-channel</code> 又是什么呢？</p><p>受 <a target=_blank rel="noopener external nofollow noreferrer" href=https://www.npmjs.com/package/js-channel>js-channel</a> 启发，<code>@luozhu/vscode-channel</code> 主要是封装了 webview 与 vscode 交互流程，核心原理是通过暴露 <code>call</code>、<code>bind</code> 方法抹平 API 的差异，减少重复代码量。其中参考 appworks 和 cs-channel 使用 uuid 保证交互的可靠性。Talk is cheap, show you the code：</p><p><strong>webview 侧</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 创建 channel 对象</span></span><br><span class=line><span class=keyword>const</span> channel = <span class=keyword>new</span> <span class="title class_">Channel</span>();</span><br><span class=line><span class=keyword>const</span> <span class="title function_">getData</span> = <span class=keyword>async</span> (<span class=params></span>) =&gt; &#123;</span><br><span class=line>  <span class=comment>// 发起一个请求，并等待其返回数据</span></span><br><span class=line>  <span class=keyword>const</span> &#123; payload &#125; = <span class=keyword>await</span> channel.<span class="title function_">call</span>(&#123; <span class=attr>method</span>: <span class=string>&#x27;queryPosts&#x27;</span> &#125;);</span><br><span class=line>  <span class="variable language_">console</span>.<span class="title function_">log</span>(payload);</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>webview 中由于 acquireVsCodeApi 只能调用一次，之后又需要在多个地方使用，所以我们在 <code>wev/src/layouts/index.ts</code> 中创建一次并挂载到 <code>window</code> 对象上比较合适。</p></blockquote><p><strong>vscode 侧</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// vscode 侧的 channel 需要依赖上下文和 WebviewPanel 实例</span></span><br><span class=line><span class=keyword>const</span> channel = <span class=keyword>new</span> <span class="title class_">Channel</span>(context, currentPanel);</span><br><span class=line><span class=comment>// 绑定一个回调函数，一般只需要创建一个，然后根据约定做分发即可</span></span><br><span class=line>channel.<span class="title function_">bind</span>(<span class=keyword>async</span> message =&gt; &#123;</span><br><span class=line>  <span class=keyword>const</span> &#123; eventType, method, params &#125; = message;</span><br><span class=line>  <span class=comment>// 实际发起请求获取数据的地方</span></span><br><span class=line>  <span class=keyword>const</span> data = <span class=keyword>await</span> events[eventType][method](params);</span><br><span class=line>  <span class=comment>// 这里将获取的数据直接返回即可，channel 内部会进行消息合并和回传。</span></span><br><span class=line>  <span class=comment>// 如果只是执行一个功能，不写 return 语句即可，内部会进行判断降级成单工通信。</span></span><br><span class=line>  <span class=keyword>return</span> data;</span><br><span class=line>&#125;);</span><br></pre></td></tr></table></figure><h2 id=vscode-国际化><a href=#vscode-国际化 class=headerlink title="vscode 国际化"></a>vscode 国际化</h2><p>我们都知道 vscode 中是可以切换语言环境的，一款优秀的 vscode 扩展至少要支持中英两种语言。而且支持国际化可以让你的插件受众直接突破国界限制。vscode 国际化分为三部分，一部分是配置的国际化，一部分是代码中的国际化，另一部分则是 webview 中 umijs 的国际化。本章我们就来具体看一下如何在 vscode 中实现国际化。</p><h3 id=配置国际化><a href=#配置国际化 class=headerlink title=配置国际化></a>配置国际化</h3><p>我们已经知道 vscode 中的配置都是在 <em>package.json</em> 中，而配置的国际化是约定在 <code>package.nls.json</code> 和 <code>package.nls.zh-cn.json</code> 这种文件中编写。比如我们要在中英文环境下命令配置中英文版本，我们可以在 <code>package.nls.json</code> 中写：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;contributes.category.juejin-me&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Juejin Me&quot;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p>在 <code>package.nls.zh-cn.json</code> 写：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;contributes.category.juejin-me&quot;</span><span class=punctuation>:</span> <span class=string>&quot;掘金一下&quot;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p>然后 <code>package.json</code> 中写：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;contributes&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;commands&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        ...</span><br><span class=line>        <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;%contributes.category.juejin-me%&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=punctuation>]</span></span><br><span class=line>  <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h3 id=代码中国际化><a href=#代码中国际化 class=headerlink title=代码中国际化></a>代码中国际化</h3><p>推荐使用洛竹贡献过代码的 <a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/axetroy/vscode-nls-i18n>vscode-nls-i18n</a>，使用方法也很简单，配置的话和上一节一样，在 <code>src/extension.ts</code> 中使用 <code>init</code> 方法初始化，然后使用 <code>localize</code> 方法实现国际化：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> &#123; init, localize &#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-nls-i18n&#x27;</span>;</span><br><span class=line><span class=keyword>export</span> <span class=keyword>function</span> <span class="title function_">activate</span>(<span class=params>context: vscode.ExtensionContext</span>) &#123;</span><br><span class=line>  <span class="title function_">init</span>(context.<span class=property>extensionPath</span>); <span class=comment>// 初始化国际化配置。只用在扩展激活时初始化一次</span></span><br><span class=line>  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">localize</span>(<span class=string>&#x27;extension.activeLog&#x27;</span>)); <span class=comment>// 之后就可以在各个文件中使用。</span></span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=umijs-国际化><a href=#umijs-国际化 class=headerlink title="umijs 国际化"></a>umijs 国际化</h3><p>umijs 的国际化需要使用 <code>@umijs/plugin-locale</code> 插件支持，这个插件封装了 <code>react-intl</code>，配置方式如下：</p><p>1、.umirc.ts 中配置 <code>local</code></p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line><span class=attr>locale</span>: &#123;&#125;</span><br></pre></td></tr></table></figure><p>2、在 <em>src</em> 目录下创建 <code>locales</code> 并创建 <code>en.ts</code> 或 <code>zh-CN.ts</code></p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/locales/en.js</span></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> &#123;</span><br><span class=line>  <span class=attr>WELCOME_TO_UMI_WORLD</span>: <span class=string>&quot;welcome to umi&#x27;s world&quot;</span>,</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/locales/zh-CN.js</span></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> &#123;</span><br><span class=line>  <span class=attr>WELCOME_TO_UMI_WORLD</span>: <span class=string>&#x27;欢迎光临  umi  的世界&#x27;</span>,</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p>3、使用国际化</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> <span class="title class_">React</span> <span class=keyword>from</span> <span class=string>&#x27;react&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; useIntl &#125; <span class=keyword>from</span> <span class=string>&#x27;umi&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=attr>default</span>: <span class="title class_">React</span>.<span class=property>FunctionComponent</span> = <span class=function>(<span class=params>props</span>) =&gt;</span> &#123;</span><br><span class=line>  <span class=keyword>const</span> intl = <span class="title function_">useIntl</span>()</span><br><span class=line>  <span class=keyword>return</span> (</span><br><span class=line>     &lt;div&gt;</span><br><span class=line>     &#123;intl.<span class="title function_">formatMessage</span>(</span><br><span class=line>        &#123;</span><br><span class=line>          <span class=attr>id</span>: <span class=string>&#x27;WELCOME_TO_UMI_WORLD&#x27;</span>,</span><br><span class=line>        &#125;</span><br><span class=line>      )&#125;&lt;div&gt;</span><br><span class=line>   )</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>4、切换语言</p><p>切换语言，我们需要使用 <code>setLocale</code> 方法，需要注意的是我们给这个方法第二个参数传入 <code>false</code> 来实现无刷新动态切换。</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> &#123; setLocale &#125; <span class=keyword>from</span> <span class=string>&#x27;umi&#x27;</span>;</span><br><span class=line><span class=comment>// 不刷新页面</span></span><br><span class=line><span class="title function_">setLocale</span>(<span class=string>&#x27;zh-CN&#x27;</span>, <span class=literal>false</span>);</span><br></pre></td></tr></table></figure><p>不过，切换语言的时机在什么时候呢？切换时机就是我们语言环境改变的时机。在 vscode webview 环境中，其实当使用 <code>Config display language</code> 方法切换语言环境后，会要求 vscode 重启。也就说我们只需要在 webview 创建时设置一次语言环境即可。由于 vscode 和 webview 传值太困难，我们选择在 <code>getUmiHTMLContent</code> 时传如 <code>vscode.env</code>：</p><figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>script</span>&gt;</span><span class=language-javascript></span></span><br><span class=line><span class=language-javascript>  <span class="variable language_">window</span>.<span class=property>vscodeEnv</span> = $&#123;<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(vscode.<span class=property>env</span>)&#125;</span></span><br><span class=line><span class=language-javascript></span><span class=tag>&lt;/<span class=name>script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后，我们在 <code>web/src/layouts/index.ts</code> 中设置一下即可：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line><span class="title function_">setLocale</span>(<span class="variable language_">window</span>.<span class=property>vscodeEnv</span>.<span class=property>language</span>, <span class=literal>false</span>);</span><br></pre></td></tr></table></figure><h2 id=“掘金一下”-扩展核心实现><a href=#“掘金一下”-扩展核心实现 class=headerlink title="“掘金一下” 扩展核心实现"></a>“掘金一下” 扩展核心实现</h2><p>灵感来源于现实，作为掘金的重度使用者，几乎每篇文章和笔记都同步在这里。当有些知识忘记需要查阅或拷贝代码时，我就有在掘金搜索我的文章的需求。但是掘金的搜索是全站的，就算加上自己的名字搜索也会出现大量无关记录。“掘金一下” 这个名字就像插件功能一样，在你想搜索自己掘金文章的时候就可以打开插件“掘金一下” 进行搜索。</p><p>其实为了只搜索到自己的文章，我想到的还有开发 chrome 插件来实现。但是考虑到市场和便捷性，我最终还是决定开发 vscode 插件来落地这个灵感。本章就是综合前面的经验实现 “掘金一下” 的核心逻辑。</p><h3 id=juejin-me-start-命令><a href=#juejin-me-start-命令 class=headerlink title="juejin-me.start 命令"></a><code>juejin-me.start</code> 命令</h3><h4 id=vscode-侧开启-channel-通信><a href=#vscode-侧开启-channel-通信 class=headerlink title="vscode 侧开启 channel 通信"></a>vscode 侧开启 channel 通信</h4><p>vscode 侧通过 <code>channel.bind</code> 绑定一个事件处理函数。</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> events <span class=keyword>from</span> <span class=string>&#x27;./events&#x27;</span>;</span><br><span class=line>...</span><br><span class=line>context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(</span><br><span class=line>  vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;juejin-me.start&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>    currentPanel = <span class="title function_">createUmiWebviewPanel</span>(</span><br><span class=line>      context,</span><br><span class=line>      <span class=string>&#x27;juejin-me&#x27;</span>,</span><br><span class=line>      <span class="title function_">localize</span>(<span class=string>&#x27;extension.webview-panel.title&#x27;</span>),</span><br><span class=line>      <span class=string>&#x27;assets/icon-luozhu.png&#x27;</span>,</span><br><span class=line>      <span class=string>&#x27;3.5.17&#x27;</span></span><br><span class=line>    );</span><br><span class=line>    <span class=comment>// 处理 webview 中的信息</span></span><br><span class=line>    channel = <span class=keyword>new</span> <span class="title class_">Channel</span>(context, currentPanel);</span><br><span class=line>    channel.<span class="title function_">bind</span>(<span class=keyword>async</span> message =&gt; &#123;</span><br><span class=line>      <span class=keyword>const</span> &#123; eventType, method, params &#125; = message;</span><br><span class=line>      <span class=comment>// 根据事件类型、方法、参数来完成一次 api 调用，内置的 eventType 有 request、command 和 variable。</span></span><br><span class=line>      <span class=keyword>const</span> data = <span class=keyword>await</span> events[eventType][method](params);</span><br><span class=line>      <span class=keyword>return</span> data;</span><br><span class=line>    &#125;, vscode);</span><br><span class=line>  &#125;)</span><br><span class=line>);</span><br></pre></td></tr></table></figure><blockquote><p>注意：我们不需要给定监听事件名，内部会根据 eventId 保证可靠性和全局唯一性</p></blockquote><h4 id=注册-events><a href=#注册-events class=headerlink title="注册 events"></a>注册 events</h4><p><strong>events/index.ts</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> requests <span class=keyword>from</span> <span class=string>&#x27;./requests&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> &#123;</span><br><span class=line>  <span class=attr>request</span>: requests,</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p><strong>events/requests</strong>：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>import</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> request <span class=keyword>from</span> <span class=string>&#x27;../utils/request&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>const</span> queryPosts = <span class=keyword>async</span> (<span class=attr>params</span>: &#123; <span class=attr>cursor</span>: <span class=built_in>string</span> &#125;): <span class="title class_">Promise</span>&lt;<span class=built_in>any</span>&gt; =&gt; &#123;</span><br><span class=line>  <span class=comment>// 这里我们根据 vscode 配置动态取的用户 id</span></span><br><span class=line>  <span class=keyword>const</span> &#123; userId &#125; = vscode.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(<span class=string>&#x27;juejin-me&#x27;</span>);</span><br><span class=line></span><br><span class=line>  <span class=keyword>const</span> &#123; cursor &#125; = params;</span><br><span class=line>  <span class=keyword>const</span> data = <span class=keyword>await</span> request.<span class="title function_">post</span>(<span class=string>&#x27;/article/query_list&#x27;</span>, &#123;</span><br><span class=line>    <span class=attr>cursor</span>: <span class=string>`<span class=subst>$&#123;cursor&#125;</span>`</span>,</span><br><span class=line>    <span class=attr>sort_type</span>: <span class=number>2</span>,</span><br><span class=line>    <span class=attr>user_id</span>: userId,</span><br><span class=line>  &#125;);</span><br><span class=line>  <span class=keyword>return</span> data;</span><br><span class=line>&#125;;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> &#123;</span><br><span class=line>  queryPosts,</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p><strong>utils/request</strong>：</p><p>这里简单封装了基于 axios 的请求对象。</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br></pre></td><td class=code><pre><span class=line><span class=comment>/* eslint-disable no-param-reassign */</span></span><br><span class=line><span class=keyword>import</span> axios <span class=keyword>from</span> <span class=string>&#x27;axios&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> qs <span class=keyword>from</span> <span class=string>&#x27;qs&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=comment>// 中文文档: http://t.cn/ROfXFuj</span></span><br><span class=line><span class=comment>// 创建实例</span></span><br><span class=line><span class=keyword>const</span> request = axios.<span class="title function_">create</span>(&#123;</span><br><span class=line>  <span class=attr>baseURL</span>: <span class=string>&#x27;https://api.juejin.cn/content_api/v1/&#x27;</span>,</span><br><span class=line>  <span class=attr>timeout</span>: <span class=number>10000</span>,</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 添加请求拦截器</span></span><br><span class=line>request.<span class=property>interceptors</span>.<span class=property>request</span>.<span class="title function_">use</span>(</span><br><span class=line>  <span class=function><span class=params>config</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (config.<span class=property>method</span> === <span class=string>&#x27;get&#x27;</span>) &#123;</span><br><span class=line>      config.<span class=property>paramsSerializer</span> = <span class=function><span class=params>params</span> =&gt;</span> qs.<span class="title function_">stringify</span>(params, &#123; <span class=attr>arrayFormat</span>: <span class=string>&#x27;repeat&#x27;</span> &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span> config;</span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=function><span class=params>error</span> =&gt;</span> &#123;</span><br><span class=line>    vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(error.<span class=property>message</span>);</span><br><span class=line>    <span class=keyword>return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class=line>  &#125;</span><br><span class=line>);</span><br><span class=line></span><br><span class=line><span class=comment>// 添加响应拦截器</span></span><br><span class=line>request.<span class=property>interceptors</span>.<span class=property>response</span>.<span class="title function_">use</span>(</span><br><span class=line>  <span class=function><span class=params>response</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>const</span> &#123; data &#125; = response;</span><br><span class=line>    <span class=keyword>return</span> data;</span><br><span class=line>  &#125;,</span><br><span class=line>  <span class=function><span class=params>error</span> =&gt;</span> &#123;</span><br><span class=line>    vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(error.<span class=property>message</span>);</span><br><span class=line>    <span class=keyword>return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class=line>  &#125;</span><br><span class=line>);</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> request;</span><br></pre></td></tr></table></figure><h3 id=webview-中调用接口><a href=#webview-中调用接口 class=headerlink title="webview 中调用接口"></a>webview 中调用接口</h3><p>channel 是在 <code>web/src/layouts/index.tsx</code> 中初始化并挂载到 window 上的，我们在 <code>web/src/pages/index.tsx</code> 中调用 <code>window.channel.call</code> 即可调用指定接口。由于我们需要模糊搜索所有的文章，所以我们需要在初始化页面时一次请求完所有数据。</p><figure class="highlight tsx"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>const</span> <span class="title function_">Homepage</span> = (<span class=params></span>) =&gt; &#123;</span><br><span class=line>  <span class=keyword>const</span> <span class="title function_">getData</span> = <span class=keyword>async</span> (<span class=params></span>) =&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> &#123; payload &#125; = (<span class=keyword>await</span> <span class="variable language_">window</span>.<span class=property>channel</span>.<span class="title function_">call</span>(&#123;</span><br><span class=line>      <span class=attr>eventType</span>: <span class=string>&#x27;request&#x27;</span>,</span><br><span class=line>      <span class=attr>method</span>: <span class=string>&#x27;queryPosts&#x27;</span>,</span><br><span class=line>      <span class=attr>params</span>: &#123; cursor &#125;,</span><br><span class=line>    &#125;)) <span class=keyword>as</span> <span class=built_in>any</span>;</span><br><span class=line>    tempData = tempData.<span class="title function_">concat</span>(payload.<span class=property>data</span>);</span><br><span class=line>    <span class="title function_">setData</span>(tempData);</span><br><span class=line>    <span class=keyword>if</span> (!payload.<span class=property>has_more</span>) &#123;</span><br><span class=line>      <span class="title function_">setInitLoading</span>(<span class=literal>false</span>);</span><br><span class=line>      <span class="title function_">setCategories</span>(<span class="title function_">_union</span>([<span class=string>&#x27;全部&#x27;</span>, ...tempData.<span class="title function_">map</span>(<span class=function><span class=params>item</span> =&gt;</span> item.<span class=property>category</span>.<span class=property>category_name</span>)]));</span><br><span class=line>      tempData = [];</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>      cursor += <span class=number>10</span>;</span><br><span class=line>      <span class="title function_">getData</span>();</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>更多具体实现细节就是一些页面编写逻辑，不是本文的重点，感兴趣的同学可以直接进查看<a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning/juejin-me/tree/main/web>源码</a>。</p><h3 id=配置掘金-ID><a href=#配置掘金-ID class=headerlink title="配置掘金 ID"></a>配置掘金 ID</h3><p><strong>声明配置</strong>：</p><p>vscode 的配置我们需要借助 package.json 的 <code>contributes.configuration</code> 属性，我们的掘金 ID 是 string，所以声明如下：</p><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;contributes&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;configuration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;%configuration.title%&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;object&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;properties&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;juejin-me.userId&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;string&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;default&quot;</span><span class=punctuation>:</span> <span class=string>&quot;325111174662855&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;%configuration.properties.juejin-me.userId%&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>      <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line>  <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><p><strong>修改配置的命令</strong>：</p><p>让用户打开设置去修改配置也可以，但是为了用户体验，我们提供了 <code>juejin-me.configUserId</code> 命令，我们来看下命令的实现：</p><figure class="highlight ts"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre></td><td class=code><pre><span class=line>context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(</span><br><span class=line>  vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;juejin-me.configUserId&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> userId = <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">showInputBox</span>(&#123;</span><br><span class=line>      <span class=attr>placeHolder</span>: <span class="title function_">localize</span>(<span class=string>&#x27;extension.juejin-me.configUserId.placeHolder&#x27;</span>),</span><br><span class=line>      <span class=attr>validateInput</span>: <span class=function><span class=params>value</span> =&gt;</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (value) &#123;</span><br><span class=line>          <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>return</span> <span class="title function_">localize</span>(<span class=string>&#x27;extension.juejin-me.configUserId.validateInput&#x27;</span>);</span><br><span class=line>      &#125;,</span><br><span class=line>    &#125;);</span><br><span class=line>    <span class=keyword>const</span> config = vscode.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(<span class=string>&#x27;juejin-me&#x27;</span>);</span><br><span class=line></span><br><span class=line>    config.<span class="title function_">update</span>(<span class=string>&#x27;userId&#x27;</span>, userId, <span class=literal>true</span>);</span><br><span class=line>  &#125;)</span><br><span class=line>);</span><br></pre></td></tr></table></figure><ul><li><a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/modules/window.html#showInputBox>vscode.window.showInputBox</a>：打开一个输入框，提示用户输入掘金用户 ID</li><li><a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/modules/workspace.html#getConfiguration>vscode.workspace.getConfiguration</a>：获取工作空间的配置对象</li><li><a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/interfaces/WorkspaceConfiguration.html#update>WorkspaceConfiguration.update</a>：更新一个配置值。</li><li><a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/interfaces/InputBoxOptions.html#validateInput>InputBoxOptions.validateInput</a>：一个可选的函数，被调用来验证输入信息并提示用户</li></ul><h3 id=插件效果展示><a href=#插件效果展示 class=headerlink title=插件效果展示></a>插件效果展示</h3><p>感兴趣的话你也可以直接在扩展中搜索“掘金一下”自行体验。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac7d2ab498b2469486e8f237fc3b7997~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91ae0fdbff7043db9513e539640fcc2e~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><h2 id=彩蛋><a href=#彩蛋 class=headerlink title=彩蛋></a>彩蛋</h2><h3 id=luozhu-create-vscode-webview><a href=#luozhu-create-vscode-webview class=headerlink title=@luozhu/create-vscode-webview></a>@luozhu/create-vscode-webview</h3><p>本文中有很多最佳实践，为了方便之后创建新的项目时减少重复工作，洛竹抽离出了一个简单的模板。掘友直接使用 <code>yarn create @luozhu/vscode-webview myvscode</code> 即可创建出一个属于自己的 vscode 扩展。参考本文的一些实践再加一些你的创意即可完成一个出色的基于 webview 的 vscode 扩展。</p><h3 id=Word-Count-Juejin><a href=#Word-Count-Juejin class=headerlink title="Word Count Juejin"></a>Word Count Juejin</h3><p>为了答谢掘金平台和掘友一直以来的支持，我编写了一款专为掘金适配的 Markdown 文件字数统计 VS Code 扩展，字数统计会实时显示在状态栏。比起来 vscode 官方的 Word Count，我们支持中文字数统计，比起来 Word Count CJK，我们支持中英文混排。如果你也喜欢使用 VS Code 的 Markdown 编辑能力，那么一定不要错过洛竹的这款插件，下载请认准：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08c060326c954849b3eb2d34f2e6b0e5~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>如果你还在犹豫要不要下载，那不妨看下三个插件的统计对比，我们拿 <code>i love juejin. 我爱掘金</code> 这个字符串测试一下三款插件的功能：</p><div class=table-container><table><thead><tr><th>Word Count</th><th>Word Count CJK</th><th>Word Count Juejin</th></tr></thead><tbody><tr><td>4 个字</td><td>4 个字</td><td>7 个字</td></tr><tr><td>中文算成了一个字</td><td>直接忽略了英文</td><td>中文4 个字加英文三个字，格局正好</td></tr></tbody></table></div><h3 id=vscode-api-cn><a href=#vscode-api-cn class=headerlink title="vscode api cn"></a>vscode api cn</h3><p>在学习和开发 vscode 插件的过程中，最大的痛点无过于 API 文档翻译的缺失。哪怕是硬着头皮看英文原版 API 文档，阅读体验也很差。为了方便自己、回馈社区，我和 <a target=_blank rel="noopener external nofollow noreferrer" href=https://juejin.cn/user/703340610597064>寒草</a> 等小伙伴决定翻译 vscode api 类型声明并使用 Typedoc 承载，另外在完工后我们也会输出 <code>@types/vscode-cn</code> 类型包代替 <code>@types/vscode</code> 进一步方便 vscode 插件开发者。团队成员现状：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa80c1603b2e4482883fe39e1b44f62e~tplv-k3u1fbpfcp-zoom-1.image alt=洛竹></p><p>翻译是一件带有侠义精神的事业，欢迎更多的小伙伴加入我们。你可以浏览<a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/vscode-cn/vscode-api-cn>仓库</a>和<a target=_blank rel="noopener external nofollow noreferrer" href=https://vscode-api-cn.js.org/ >官网</a>了解具体情况。</p><h2 id=后记><a href=#后记 class=headerlink title=后记></a>后记</h2><p>这是第一次尝试写这么长的文章，断断续续经历了有半个月，本着对读者负责任的态度，文中的实践都是经过反复测试以及和同事朋友的讨论。当然 vscode 插件开发的概念和 API 比较多，一篇文章也很难讲全，讲透彻。如果大家感兴趣，可以在评论区告诉洛竹，我可以继续更新这方面的教程。</p><blockquote><p>本文首发于「掘金专栏」，同步于公众号「程序人生」。</p></blockquote></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta>文章作者: </span><span class=post-copyright-info><a target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning>洛竹</a></span></div><div class=post-copyright__type><span class=post-copyright-meta>文章链接: </span><span class=post-copyright-info><a href=https://youngjuning.js.org/609531a3ab52/ >https://youngjuning.js.org/609531a3ab52/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta>版权声明: </span><span class=post-copyright-info>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ rel="external nofollow noreferrer" target=_blank>CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href=https://youngjuning.js.org target=_blank>洛竹的博客</a>！</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/%E6%8E%98%E9%87%91/ >掘金</a><a class=post-meta__tags href=/tags/VS-Code/ >VS Code</a><a class=post-meta__tags href=/tags/Webview/ >Webview</a><a class=post-meta__tags href=/tags/%E6%89%A9%E5%B1%95/ >扩展</a></div><div class=post_share><div class=social-share data-image=https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f53c4850008a49a5baa25a0e5f1b626b~tplv-k3u1fbpfcp-zoom-crop-mark:3024:3024:3024:1702.awebp data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js defer=defer></script></div></div><div class=post-reward><div class=reward-button><i class="fas fa-qrcode"></i> 打赏</div><div class=reward-main><ul class=reward-all><li class=reward-item><a href=https://cdn.jsdelivr.net/gh/youngjuning/images/wechat.png rel="external nofollow noreferrer" target=_blank><img class=post-qr-code-img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images/wechat.png alt=微信></a><div class=post-qr-code-desc>微信</div></li><li class=reward-item><a href=https://cdn.jsdelivr.net/gh/youngjuning/images/alipay7.png rel="external nofollow noreferrer" target=_blank><img class=post-qr-code-img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images/alipay7.png alt=支付宝></a><div class=post-qr-code-desc>支付宝</div></li></ul></div></div><div class=ads-wrap><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-7962287588031867 data-ad-slot=2542544532></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class=pagination-post id=pagination><div class="prev-post pull-left"><a href=/f4ea430d1d6d/ title="前端组件化实战之 Button"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b79b60e52f9b4e199372d26724e81a59~tplv-k3u1fbpfcp-zoom-crop-mark:1512:1512:1512:851.awebp onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class=pagination-info><div class=label>上一篇</div><div class=prev_info>前端组件化实战之 Button</div></div></a></div><div class="next-post pull-right"><a href=/1bbed3d2a249/ title="如何开发一款 VS Code yarn.lock 预览插件"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/01/14/19/50/flower-7718952_1280.jpg onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class=pagination-info><div class=label>下一篇</div><div class=next_info>如何开发一款 VS Code yarn.lock 预览插件</div></div></a></div></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class=relatedPosts-list><div><a href=/a7d393e0caa2/ title="TypeScript 中 type 和 interface 的区别"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://i.loli.net/2020/02/19/MIStsCk9XxZgv3G.png alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2020-02-19</div><div class=title>TypeScript 中 type 和 interface 的区别</div></div></a></div><div><a href=/614cd34a921f/ title="从零开发一个 Node Cli"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://i.loli.net/2020/03/04/IZEm27KSLcz3h9r.png alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2020-02-17</div><div class=title>从零开发一个 Node Cli</div></div></a></div><div><a href=/5d19fd0218f8/ title=少壮不努力，老大写博客><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1678264386252.png alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2021-06-04</div><div class=title>少壮不努力，老大写博客</div></div></a></div><div><a href=/eae5334982a6/ title=每个前端都值得拥有自己的组件库，就像每个夏天都拥有西瓜🍉><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images/202109211319760.png alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2021-07-12</div><div class=title>每个前端都值得拥有自己的组件库，就像每个夏天都拥有西瓜🍉</div></div></a></div><div><a href=/78713277e253/ title="玩转 React Native 自定义字体"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://i.loli.net/2020/02/29/4AacpxzRh8nfY2B.png alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2020-02-29</div><div class=title>玩转 React Native 自定义字体</div></div></a></div><div><a href=/c3f1c12d5d33/ title=闲鱼宗心大佬聊跨端职业发展><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766587_1280.jpg alt=cover><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2023-04-19</div><div class=title>闲鱼宗心大佬聊跨端职业发展</div></div></a></div></div></div><hr><div id=post-comment><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class=comment-wrap><div><div id=giscus-wrap></div></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info"><div class=is-center><div class=avatar-img><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1680450378978.png onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info__name>洛竹</div><div class=author-info__description>怕什么真理无穷，进一寸有一寸的欢喜。</div></div><div class="card-info-data site-data is-center"><a href=/archives/ ><div class=headline>文章</div><div class=length-num>142</div></a><a href=/tags/ ><div class=headline>标签</div><div class=length-num>480</div></a><a href=/categories/ ><div class=headline>分类</div><div class=length-num>50</div></a></div><a id=card-info-btn target=_blank rel="noopener external nofollow noreferrer" href=https://github.com/youngjuning><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class=social-icon href=https://github.com/youngjuning/youngjuning.github.io rel="external nofollow noreferrer" target=_blank title=Github><i class="fab fa-github"></i></a><a class=social-icon href=mailto:youngjuning@163.com rel="external nofollow noreferrer" target=_blank title=Email><i class="fas fa-envelope"></i></a><a class=social-icon href=https://cdn.jsdelivr.net/gh/youngjuning/images/202109211725265.png rel="external nofollow noreferrer" target=_blank title=微信><i class="fab fa-weixin"></i></a><a class=social-icon href=https://twitter.com/luozhu2021 rel="external nofollow noreferrer" target=_blank title=推特><i class="fab fa-twitter"></i></a></div></div><div class="card-widget card-announcement"><div class=item-headline><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class=announcement_content>《React Native 仿 Product Hunt 实战开发》教程正在紧锣密鼓地写作中，敬请期待！</div></div><div class="card-widget user-map" id=user-map><div class=item-headline><i class="fas fa-global"></i><span>访客地图</span></div><div class=item-content><script async type=text/javascript id=clstr_globe src="//clustrmaps.com/globe.js?d=GxY0uNwJ-R6qfXXonTr3FEq7qT8qAPpGdd-XpGVHSEo"></script></div></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>目录</span><span class=toc-percentage></span></div><div class="toc-content is-expand"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%89%8D%E8%A8%80><span class=toc-number>1.</span> <span class=toc-text>前言</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#Hello-vscode><span class=toc-number>2.</span> <span class=toc-text>Hello vscode</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE><span class=toc-number>2.1.</span> <span class=toc-text>初始化项目</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83><span class=toc-number>2.2.</span> <span class=toc-text>代码规范</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BA%A6%E5%AE%9A%E5%BC%8F%E6%8F%90%E4%BA%A4><span class=toc-number>2.3.</span> <span class=toc-text>约定式提交</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B0%83%E8%AF%95><span class=toc-number>2.4.</span> <span class=toc-text>调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%89%93%E5%8C%85><span class=toc-number>3.</span> <span class=toc-text>打包</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%89%93%E5%8C%85%E5%8E%9F%E7%90%86><span class=toc-number>3.1.</span> <span class=toc-text>打包原理</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BD%BF%E7%94%A8-esbuild-%E4%BC%98%E5%8C%96%E6%89%93%E5%8C%85><span class=toc-number>3.2.</span> <span class=toc-text>使用 esbuild 优化打包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%9B%86%E6%88%90-umijs><span class=toc-number>4.</span> <span class=toc-text>集成 umijs</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%9D%E5%A7%8B%E5%8C%96-umi-%E9%A1%B9%E7%9B%AE><span class=toc-number>4.1.</span> <span class=toc-text>初始化 umi 项目</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6><span class=toc-number>4.2.</span> <span class=toc-text>忽略文件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#yarn-workspace><span class=toc-number>4.3.</span> <span class=toc-text>yarn workspace</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B0%83%E8%AF%95-1><span class=toc-number>4.4.</span> <span class=toc-text>调试</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96%E5%B7%A5%E4%BD%9C><span class=toc-number>4.5.</span> <span class=toc-text>其他优化工作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#vscode-%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5><span class=toc-number>5.</span> <span class=toc-text>vscode 插件开发核心概念</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%E6%BF%80%E6%B4%BB%E4%BA%8B%E4%BB%B6><span class=toc-number>5.1.</span> <span class=toc-text>1. 激活事件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%E5%8F%91%E5%B8%83%E5%86%85%E5%AE%B9%E9%85%8D%E7%BD%AE><span class=toc-number>5.2.</span> <span class=toc-text>2. 发布内容配置</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-VS-Code-API><span class=toc-number>5.3.</span> <span class=toc-text>3. VS Code API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%9B%86%E6%88%90-webview><span class=toc-number>6.</span> <span class=toc-text>集成 webview</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%B3%A8%E5%86%8C%E5%91%BD%E4%BB%A4><span class=toc-number>6.1.</span> <span class=toc-text>注册命令</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%9B%E5%BB%BA-webview-%E9%9D%A2%E6%9D%BF><span class=toc-number>6.2.</span> <span class=toc-text>创建 webview 面板</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%A9%BA%E7%99%BD%E7%9A%84%E9%9D%A2%E6%9D%BF><span class=toc-number>6.2.1.</span> <span class=toc-text>创建一个空白的面板</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E7%BB%99%E9%9D%A2%E6%9D%BF%E8%AE%BE%E7%BD%AE%E5%86%85%E5%AE%B9><span class=toc-number>6.2.2.</span> <span class=toc-text>给面板设置内容</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E9%99%90%E5%88%B6-webview-%E8%A7%86%E5%9B%BE%E4%B8%BA%E4%B8%80%E4%B8%AA><span class=toc-number>6.2.3.</span> <span class=toc-text>限制 webview 视图为一个</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%AE%BE%E7%BD%AE-Icon><span class=toc-number>6.2.4.</span> <span class=toc-text>设置 Icon</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#webview-%E8%8E%B7%E5%8F%96%E5%86%85%E5%AE%B9%E7%9A%84-Uri><span class=toc-number>6.2.5.</span> <span class=toc-text>webview 获取内容的 Uri</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BD%BF%E7%94%A8-umi-%E5%BC%80%E5%8F%91-webview><span class=toc-number>6.3.</span> <span class=toc-text>使用 umi 开发 webview</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B0%81%E8%A3%85%E8%8E%B7%E5%8F%96-umijs-%E6%89%93%E5%8C%85%E4%BA%A7%E7%89%A9%E7%9A%84%E6%96%B9%E6%B3%95><span class=toc-number>6.3.1.</span> <span class=toc-text>封装获取 umijs 打包产物的方法</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E4%BC%98%E5%8C%96%E6%89%93%E5%8C%85><span class=toc-number>6.3.2.</span> <span class=toc-text>优化打包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BB%99-webview-%E5%86%85%E5%AE%B9%E5%8A%A0%E4%B8%8A%E4%B8%BB%E9%A2%98><span class=toc-number>6.4.</span> <span class=toc-text>给 webview 内容加上主题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#webview-%E4%B8%8E-vscode-%E4%BA%A4%E4%BA%92><span class=toc-number>7.</span> <span class=toc-text>webview 与 vscode 交互</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#webview-%E4%B8%AD%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC><span class=toc-number>7.1.</span> <span class=toc-text>webview 中执行脚本</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8F%92%E4%BB%B6%E4%BC%A0%E9%80%92%E4%BF%A1%E6%81%AF%E7%BB%99-webview><span class=toc-number>7.2.</span> <span class=toc-text>插件传递信息给 webview</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#webview-%E4%BC%A0%E9%80%92%E4%BF%A1%E6%81%AF%E7%BB%99%E6%8F%92%E4%BB%B6><span class=toc-number>7.3.</span> <span class=toc-text>webview 传递信息给插件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9C%A8-webview-%E4%B8%AD%E8%AF%B7%E6%B1%82%E6%8E%A5%E5%8F%A3><span class=toc-number>7.4.</span> <span class=toc-text>在 webview 中请求接口</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#luozhu-vscode-channel><span class=toc-number>7.5.</span> <span class=toc-text>@luozhu&#x2F;vscode-channel</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#vscode-%E5%9B%BD%E9%99%85%E5%8C%96><span class=toc-number>8.</span> <span class=toc-text>vscode 国际化</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%85%8D%E7%BD%AE%E5%9B%BD%E9%99%85%E5%8C%96><span class=toc-number>8.1.</span> <span class=toc-text>配置国际化</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%9B%BD%E9%99%85%E5%8C%96><span class=toc-number>8.2.</span> <span class=toc-text>代码中国际化</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#umijs-%E5%9B%BD%E9%99%85%E5%8C%96><span class=toc-number>8.3.</span> <span class=toc-text>umijs 国际化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E2%80%9C%E6%8E%98%E9%87%91%E4%B8%80%E4%B8%8B%E2%80%9D-%E6%89%A9%E5%B1%95%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0><span class=toc-number>9.</span> <span class=toc-text>“掘金一下” 扩展核心实现</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#juejin-me-start-%E5%91%BD%E4%BB%A4><span class=toc-number>9.1.</span> <span class=toc-text>juejin-me.start 命令</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#vscode-%E4%BE%A7%E5%BC%80%E5%90%AF-channel-%E9%80%9A%E4%BF%A1><span class=toc-number>9.1.1.</span> <span class=toc-text>vscode 侧开启 channel 通信</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%B3%A8%E5%86%8C-events><span class=toc-number>9.1.2.</span> <span class=toc-text>注册 events</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#webview-%E4%B8%AD%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3><span class=toc-number>9.2.</span> <span class=toc-text>webview 中调用接口</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%85%8D%E7%BD%AE%E6%8E%98%E9%87%91-ID><span class=toc-number>9.3.</span> <span class=toc-text>配置掘金 ID</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8F%92%E4%BB%B6%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA><span class=toc-number>9.4.</span> <span class=toc-text>插件效果展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BD%A9%E8%9B%8B><span class=toc-number>10.</span> <span class=toc-text>彩蛋</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#luozhu-create-vscode-webview><span class=toc-number>10.1.</span> <span class=toc-text>@luozhu&#x2F;create-vscode-webview</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#Word-Count-Juejin><span class=toc-number>10.2.</span> <span class=toc-text>Word Count Juejin</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#vscode-api-cn><span class=toc-number>10.3.</span> <span class=toc-text>vscode api cn</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%90%8E%E8%AE%B0><span class=toc-number>11.</span> <span class=toc-text>后记</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>最新文章</span></div><div class=aside-list><div class=aside-list-item><a class=thumbnail href=/5c6d54a112a6/ title="2023 Google Adsense 中国大陆账户注册教程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1682570786092.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt="2023 Google Adsense 中国大陆账户注册教程"></a><div class=content><a class=title href=/5c6d54a112a6/ title="2023 Google Adsense 中国大陆账户注册教程">2023 Google Adsense 中国大陆账户注册教程</a><time datetime=2023-04-27T04:36:47.000Z title="发表于 2023-04-27 12:36:47">2023-04-27</time></div></div><div class=aside-list-item><a class=thumbnail href=/f6ae9b237db3/ title="微信 oAuth 网页授权流程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1682564623975.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt="微信 oAuth 网页授权流程"></a><div class=content><a class=title href=/f6ae9b237db3/ title="微信 oAuth 网页授权流程">微信 oAuth 网页授权流程</a><time datetime=2023-04-27T03:02:56.000Z title="发表于 2023-04-27 11:02:56">2023-04-27</time></div></div><div class=aside-list-item><a class=thumbnail href=/ec072d4935bc/ title="React Native 引入第三方 Android SDK"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://i.loli.net/2021/04/07/Vm2bOetv4HuB3Al.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt="React Native 引入第三方 Android SDK"></a><div class=content><a class=title href=/ec072d4935bc/ title="React Native 引入第三方 Android SDK">React Native 引入第三方 Android SDK</a><time datetime=2023-04-21T10:40:00.000Z title="发表于 2023-04-21 18:40:00">2023-04-21</time></div></div><div class=aside-list-item><a class=thumbnail href=/7c184cbc698e/ title="React VDOM 原理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.jsdelivr.net/gh/youngjuning/images@main/1681984770380.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt="React VDOM 原理"></a><div class=content><a class=title href=/7c184cbc698e/ title="React VDOM 原理">React VDOM 原理</a><time datetime=2023-04-20T09:55:04.000Z title="发表于 2023-04-20 17:55:04">2023-04-20</time></div></div><div class=aside-list-item><a class=thumbnail href=/8fcf3519517c/ title="叮，一份 Deno GitHub Action 源码解析请查收"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=https://cdn.pixabay.com/photo/2023/02/04/07/50/flower-7766608_1280.jpg onerror='this.onerror=null,this.src="/img/404.jpg"' alt="叮，一份 Deno GitHub Action 源码解析请查收"></a><div class=content><a class=title href=/8fcf3519517c/ title="叮，一份 Deno GitHub Action 源码解析请查收">叮，一份 Deno GitHub Action 源码解析请查收</a><time datetime=2023-04-19T10:50:31.000Z title="发表于 2023-04-19 18:50:31">2023-04-19</time></div></div></div></div><div class="card-widget ads-wrap"><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7962287588031867 data-ad-slot=1257383027 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id=footer style="background:0 0"></footer></div><div id=rightside><div id=rightside-config-hide><button id=readmode type=button title=阅读模式><i class="fas fa-book-open"></i></button><button id=translateLink type=button title=简繁转换>繁</button><button id=darkmode type=button title=浅色和深色模式转换><i class="fas fa-adjust"></i></button><button id=hide-aside-btn type=button title=单栏和双栏切换><i class="fas fa-arrows-alt-h"></i></button></div><div id=rightside-config-show><button id=rightside_config type=button title=设置><i class="fas fa-cog fa-spin"></i></button><button class=close id=mobile-toc-button type=button title=目录><i class="fas fa-list-ul"></i></button><a id=to_comment href=#post-comment title=直达评论><i class="fas fa-comments"></i></a><button id=go-up type=button title=回到顶部><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src=https://cdn.jsdelivr.net/gh/youngjuning/youngjuning.github.io@gh-pages/js/utils.js></script><script src=https://cdn.jsdelivr.net/gh/youngjuning/youngjuning.github.io@gh-pages/js/main.js></script><script src=https://cdn.jsdelivr.net/gh/youngjuning/youngjuning.github.io@gh-pages/js/tw_cn.js></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js></script><script src=https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class=js-pjax><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");var t;e.length&&(window.runMermaid=()=>{window.loadMermaid=!0;const n="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach((e,t)=>{const d=e.firstElementChild;e="%%{init:{ 'theme':'"+n+"'}}%%\n"+d.textContent;mermaid.mermaidAPI.render("mermaid-"+t,e,e=>{d.insertAdjacentHTML("afterend",e)})})},t=()=>{window.loadMermaid?runMermaid():getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(runMermaid)},window.pjax?t():document.addEventListener("DOMContentLoaded",t))})()</script><script>function loadGiscus(){var t,e="dark"===document.documentElement.getAttribute("data-theme")?"dark":"light",a=Object.assign({src:"https://giscus.app/client.js","data-repo":"youngjuning/youngjuning.github.io","data-repo-id":"R_kgDOGFxZtw","data-category-id":"DIC_kwDOGFxZt84CUMwP","data-mapping":"pathname","data-theme":e,"data-reactions-enabled":"1",crossorigin:"anonymous",async:!0},{"data-mapping":"og:title","data-lang":"zh-CN","data-input-position":"top"}),n=document.createElement("script");for(t in a)n.setAttribute(t,a[t]);document.getElementById("giscus-wrap").insertAdjacentElement("afterbegin",n)}function changeGiscusTheme(){var t,e="dark"===document.documentElement.getAttribute("data-theme")?"dark":"light";e={setConfig:{theme:e}},(t=document.querySelector("iframe.giscus-frame"))&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")}function loadOtherComment(){loadGiscus()}btf.loadComment(document.getElementById("giscus-wrap"),loadGiscus)</script></div><canvas class=fireworks mobile=false></canvas><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js></script><script defer=defer id=fluttering_ribbon mobile=false src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js></script><script src=https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></div><div id=local-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>搜索</span><span id=loading-status></span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=is-center id=loading-database><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class=search-wrap><div id=local-search-input><div class=local-search-box><input class=local-search-box--input placeholder=搜索文章 type=text></div></div><hr><div id=local-search-results></div></div></div><div id=search-mask></div><script src=https://cdn.jsdelivr.net/gh/youngjuning/youngjuning.github.io@gh-pages/js/search/local-search.js></script></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer");console.log("已挂载butterfly_footer_beautify"),e.innerHTML='<footer id="footer" style="background: transparent"><div id="footer_icons"><div><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://youngjuning.js.org/" title="个人主页"><i class="fa-solid fa-compass"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://res.abeim.cn/api/qq/?qq=2252484287" title="联系QQ"><i class="fa-brands fa-qq"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://cdn.jsdelivr.net/gh/youngjuning/images/202109211725265.png" title="联系微信"><i class="fa-brands fa-weixin"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="mailto:luozhu2021@gmail.com" title="发送邮件"><i class="fa-solid fa-envelope"></i></a></div><img class="footer_logo" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/youngjuning/images@main/1680450378978.png" onclick="btf.scrollToDest(0,500)" title="返回顶部"/><div><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://github.com/youngjuning" title="Github主页"><i class="fa-brands fa-github"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://www.npmjs.com/~youngjuning" title="NPM"><i class="fab fa-npm"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://space.bilibili.com/52457741" title="哔哩哔哩主页"><i class="fa-brands fa-bilibili"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://twitter.com/luozhu2021" title="推特主页"><i class="fab fa-twitter"></i></a></div></div><div id="footer_content"><div class="footer-group"><h3 class="footer-title">导航</h3><div class="footer-links"><a class="footer-item" href="/frontend/">前端导航</a><a class="footer-item" href="/tool/">工具导航</a><a class="footer-item" href="/oversea/">跨境导航</a><a class="footer-item" href="/yingxiao/">营销导航</a><a class="footer-item" href="/wangzhuan/">网赚导航</a><a class="footer-item" href="/webmaster/">站长导航</a><a class="footer-item" href="/vpn/">科学上网</a></div></div><div class="footer-group"><h3 class="footer-title">关于</h3><div class="footer-links"><a class="footer-item" href="/about/">关于我</a><a class="footer-item" href="/atom.xml">RSS订阅</a><a class="footer-item" target="_blank" href="https://www.githubstatus.com/" rel="external nofollow noreferrer">站点监控</a><a class="footer-item" href="/timeline/">时间轴</a><a class="footer-item" href="/album/">我的相册</a></div></div><div class="footer-group"><h3 class="footer-title">分类</h3><div class="footer-links"><a class="footer-item" href="/categories/前端/">前端</a><a class="footer-item" href="/categories/副业/">副业</a><a class="footer-item" href="/categories/漫谈/">漫谈</a><a class="footer-item" href="/categories/加密货币/">加密货币</a><a class="footer-item" href="/categories/站点运营/">站点运营</a><a class="footer-item" href="/categories/">查看全部</a></div></div><div class="footer-group"><h3 class="footer-title">时间轴</h3><div class="footer-links"><a class="footer-item" href="/timeline/luozhu/">洛竹</a><a class="footer-item" href="/timeline/chatgpt/">ChatGPT</a><a class="footer-item" href="/timeline/doge/">狗狗币</a></div></div></div><div id="footer-bottom"><div class="footer-bottom-content"><div class="footer-bottom-left"><span class="copyright">&copy;2021 - 2023 By <a target="_blank" rel="noopener" href="https://youngjuning.js.org/" title="点击访问&quot;洛竹&quot;的主页" style="margin-left:5px">洛竹</a></span><div><a class="footer-bottom-link" target="_blank" href="https://github.com/" rel="noopener external nofollow" title="本站托管服务">Github</a><a class="footer-bottom-link" target="_blank" href="https://www.jsdelivr.com/" rel="noopener external nofollow" title="本站 CDN 支持">jsDelivr</a><a class="footer-bottom-link" target="_blank" href="/gallery/" rel="noopener external nofollow" title="本站图床支持">Gallery</a><a class="footer-bottom-link" target="_blank" href="https://js.org/" rel="noopener external nofollow" title="本站域名支持">JS ORG</a><a class="footer-bottom-link" target="_blank" href="/rss2.xml" rel="noopener external nofollow" title="本站 RSS2 订阅链接">RSS2</a><a class="footer-bottom-link" target="_blank" href="/atom.xml" rel="noopener external nofollow" title="本站 Atom 格式订阅链接">Atom</a></div></div><div class="footer-bottom-right"><div id="runtime" title="已运行时长">本站已运行：0 天 0 时 0 分 0 秒</div><div><a class="footer-bottom-link" target="_blank" href="https://hexo.io/zh-cn/" rel="noopener external nofollow" title="框架">Hexo</a><a class="footer-bottom-link" target="_blank" href="https://butterfly.js.org/" rel="noopener external nofollow" title="主题">Butterfly</a></div></div></div></div></footer>'}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script defer=defer src=/js/footer.min.js></script><script data-pjax>function butterfly_swiper_injector_config(){var s=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),s.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="f6093e483bf0/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/youngjuning/images@main/1679280067130.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-19</span><a class="blog-slider__title" href="f6093e483bf0/" alt="">Go 语言教程系列の介绍和环境安装</a><div class="blog-slider__text">这是我们 Golang 教程系列中的第一篇教程。本教程介绍了 Go，并讨论了选择 Go 而不是其他编程语言的原因。我们还将学习如何在 Mac OS，Windows 和 Linux 中安装 Go。</div><a class="blog-slider__button" href="f6093e483bf0/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="d744d1d3d1e8/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/07/14/45/snow-7774312_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-02-06</span><a class="blog-slider__title" href="d744d1d3d1e8/" alt="">OpenAI 推出超神 ChatGPT 注册攻略来了</a><div class="blog-slider__text">OpenAI 推出超神 ChatGPT，非常火爆。但是呢，由于 ChatGPT 注册的问题，大部分人无法体验到。这里我分享一下我的国内 ChatGPT 注册攻略。</div><a class="blog-slider__button" href="d744d1d3d1e8/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="cb03d5cd6dce/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-31</span><a class="blog-slider__title" href="cb03d5cd6dce/" alt="">2023 年度计划</a><div class="blog-slider__text">计划赶不上变化，但是变化也不会赶上计划。</div><a class="blog-slider__button" href="cb03d5cd6dce/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="db7a22999938/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.pixabay.com/photo/2023/02/04/07/38/cherry-blossoms-7766588_1280.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-02</span><a class="blog-slider__title" href="db7a22999938/" alt="">2023 常用 NPM 包推荐</a><div class="blog-slider__text">本文主要收了一些常用 NPM 包，帮助开发者从 NPM 包选型的角度感知和建立前端工程化体系。</div><a class="blog-slider__button" href="db7a22999938/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer=defer src=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js></script><script defer=defer data-pjax src=https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js></script><script async src=//at.alicdn.com/t/font_2032782_8d5kxvn09md.js></script></body></html>